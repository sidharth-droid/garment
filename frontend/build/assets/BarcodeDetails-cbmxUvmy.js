import{r as a,G as c,j as t,J as d,K as x,ac as O,ad as b,a6 as v,a7 as y,a8 as S,a9 as w,U as f,X as le,S as ce,Y as de,Z as me,_ as F,$ as s,a1 as he,ae as ue}from"./index-BhtkFF-l.js";import{A as ge}from"./Alert-Bst-cZB2.js";function ve(){const[pe,L]=a.useState(""),[m,C]=a.useState(""),[h,I]=a.useState(""),[u,_]=a.useState(""),[g,N]=a.useState(""),[l,E]=a.useState(""),[xe,Z]=a.useState(""),[P,k]=a.useState([]),[R,r]=a.useState(""),[Q,j]=a.useState(!1),[G,H]=a.useState([]),[J,U]=a.useState([]),[X,Y]=a.useState([]),[fe,B]=a.useState(!0),[o,z]=a.useState([]),[V,$]=a.useState(!1),[T,W]=a.useState(""),[A,D]=a.useState(""),ee=a.useRef(null),M=a.useRef(null),K=a.useRef(null),q=a.useRef(null),p=(e,n)=>{e.key==="Enter"&&(e.preventDefault(),n!=null&&n.current&&n.current.focus())};a.useEffect(()=>{c.get("api/barcode/code/").then(e=>{k(e.data.barcodes||[])}).catch(e=>{console.error("Error fetching stock entries:",e)}),c.get("api/user/categories/").then(e=>{H(e.data),B(!1)}).catch(e=>{console.error("Error fetching categories:",e),B(!1)})},[]),a.useEffect(()=>{c.get("api/user/items/").then(e=>{e.data&&e.data.data&&U(e.data.data)}).catch(e=>console.error("Error fetching items:",e))},[]),a.useEffect(()=>{l&&c.get(`api/user/subcategories/${l}`).then(e=>Y(e.data)).catch(e=>console.error("Error fetching subcategories:",e))},[l]);const te=(e,n)=>{e.target.checked?z([...o,n]):z(o.filter(i=>i.id!==n.id))},ae=()=>{if(o.length===0){r("No items selected for preview.");return}r(""),$(!0)},ne=()=>{const e=/^[0-9]+$/,n=/^[0-9]+(\.[0-9]+)?$/,i=/^[A-Za-z0-9]+$/,oe=/^[A-Za-z\s]+$/;return!m||!e.test(m)?(r("Invalid quantity: Only digits are allowed."),!1):!g||!n.test(g)?(r("Invalid price: Only numbers and a decimal point are allowed."),!1):!h||!i.test(h)?(r("Invalid item size: Only letters and numbers are allowed."),!1):!u||!oe.test(u)?(r("Invalid shop name: Only letters and spaces are allowed."),!1):(r(""),!0)},se=()=>{W(""),L(""),C(""),I(""),_(""),N(""),E(""),Z(""),D(""),r(""),j(!1)},re=()=>{if(!ne())return;const e={item_name:T,quantity:parseInt(m,10),item_price:parseFloat(g),item_size:h,shop_name:u,category_name:l,sub_category:A};console.log("New entry data:",e),c.post("api/barcode/code/",e).then(n=>{k([...P,n.data]),se()}).catch(n=>{console.error("Error in barcoding:",n),r("Error in barcoding. Please try again.")})},ie=()=>{if(o.length===0){r("Please select items to print.");return}const e=`
      <html>
        <head>
          <title>Barcode Print</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .barcode { margin: 10px 0; }
            .barcode img { width: 200px; height: auto; }
            .item-name { font-weight: bold; margin-bottom: 10px; }
          </style>
        </head>
        <body>
          <h1>Barcode Preview</h1>
          ${o.map(i=>`
              <div class="barcode">
                <div class="item-name">${i.item_name}</div>
                <img src="data:image/png;base64,${i.barcode_image_base64}" alt="Barcode">
              </div>
            `).join("")}
          <script>
            window.onload = function() {
              window.print();
              window.close();
            };
          <\/script>
        </body>
      </html>
    `,n=window.open("","_blank","width=800,height=600");n.document.open(),n.document.write(e),n.document.close()};return t.jsxs("div",{children:[t.jsxs(d,{sx:{padding:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(x,{onClick:()=>j(!0),variant:"contained",color:"secondary",children:"Add Barcode"}),t.jsxs(d,{children:[t.jsx(x,{onClick:ae,variant:"contained",color:"primary",sx:{marginRight:"10px"},children:"Preview"}),t.jsx(x,{onClick:ie,variant:"contained",color:"secondary",children:"Print"})]}),R&&t.jsx(ge,{severity:"error",children:R})]}),t.jsx(O,{open:Q,onClose:()=>j(!1),children:t.jsxs(d,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:700,bgcolor:"#f9dff5",border:"2px solid #000",boxShadow:24,p:4},children:[t.jsx(b,{variant:"h6",children:"Add Barcode Details"}),t.jsxs(v,{fullWidth:!0,margin:"normal",children:[t.jsx(y,{children:"Category"}),t.jsx(S,{value:l,onChange:e=>E(e.target.value),children:G.map(e=>t.jsx(w,{value:e.category_name,children:e.category_name},e.id))})]}),t.jsxs(v,{fullWidth:!0,margin:"normal",children:[t.jsx(y,{children:"Item Name"}),t.jsx(S,{value:T,onChange:e=>W(e.target.value),children:J.map(e=>t.jsx(w,{value:e.item_name,children:e.item_name},e.id))})]}),t.jsxs(v,{fullWidth:!0,margin:"normal",children:[t.jsx(y,{children:"Sub Categories"}),t.jsx(S,{value:A,onChange:e=>D(e.target.value),children:X.map(e=>t.jsx(w,{value:e.name,children:e.name},e.id))})]}),t.jsx(f,{label:"Quantity",type:"number",value:m,onChange:e=>C(e.target.value),margin:"normal",inputRef:ee,onKeyDown:e=>p(e,M),fullWidth:!0}),t.jsx(f,{label:"Item Price",value:g,onChange:e=>N(e.target.value),margin:"normal",inputRef:M,onKeyDown:e=>p(e,K),fullWidth:!0}),t.jsx(f,{label:"Item Size",value:h,onChange:e=>I(e.target.value),margin:"normal",inputRef:K,onKeyDown:e=>p(e,q),fullWidth:!0}),t.jsx(f,{l:!0,label:"Shop Name",value:u,onChange:e=>_(e.target.value),margin:"normal",inputRef:q,onKeyDown:e=>p(e,null),fullWidth:!0}),t.jsx(x,{onClick:re,variant:"contained",color:"secondary",sx:{mt:2},children:"Save"})]})}),t.jsx(O,{open:V,onClose:()=>$(!1),children:t.jsxs(d,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:600,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4},children:[t.jsx(b,{variant:"h6",sx:{marginBottom:"20px"},children:"Barcode Preview"}),o.map((e,n)=>t.jsxs(d,{sx:{display:"flex",alignItems:"center",marginBottom:"10px"},children:[t.jsx("img",{src:`data:image/png;base64,${e.barcode_image_base64}`,alt:"Barcode",style:{width:"200px",marginRight:"10px"}}),t.jsx(b,{children:e.item_name})]},n))]})}),t.jsx(le,{component:ce,sx:{marginTop:"20px"},children:t.jsxs(de,{children:[t.jsx(me,{children:t.jsxs(F,{children:[t.jsx(s,{children:"Select"}),t.jsx(s,{children:"SL. No"}),t.jsx(s,{children:"Barcode"}),t.jsx(s,{children:"Item Name"}),t.jsx(s,{children:"Item Size"}),t.jsx(s,{children:"Shop Name"}),t.jsx(s,{children:"Category Name"})]})}),t.jsx(he,{children:P.map((e,n)=>t.jsxs(F,{children:[t.jsx(s,{children:t.jsx(ue,{onChange:i=>te(i,e),checked:o.includes(e)})}),t.jsx(s,{children:n+1}),t.jsx(s,{children:e.serial_number}),t.jsx(s,{children:e.item_name}),t.jsx(s,{children:e.item_size}),t.jsx(s,{children:e.shop_name}),t.jsx(s,{children:e.category_name})]},e.id))})]})})]})}export{ve as default};
