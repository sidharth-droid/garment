import{r as c,j as e,J,K as d,M as T,O as k,Q as L,S as $,U as x,V as q,W as z,X as Q,Y as X,Z as ee,_ as I,$ as l,a0 as w,a1 as ae,a2 as te,a3 as oe,a4 as re,G as f}from"./index-D56_o9iE.js";import{E as ne}from"./jspdf.plugin.autotable-DwG2OO1T.js";import{D as se}from"./Download-BcoFGlUQ.js";function de(){const[o,u]=c.useState({category_name:"",category_code:"",sub_category_name:{},description:""}),[g,y]=c.useState([]),[C,m]=c.useState({add:!1,fetch:!0}),[W,p]=c.useState(!1),[h,j]=c.useState(null),[Z,b]=c.useState(!1),[K,U]=c.useState(null),B=c.useRef(null),S=c.useRef(null),v=c.useRef(null),E=c.useRef(null);c.useEffect(()=>{(async()=>{try{const i=(await f.get("/api/user/categories/")).data.reduce((r,s)=>(r[s.category_code]={...s,sub_category_name:s.sub_category_name??[]},r),{});y(i)}catch(t){console.error("Fetch error:",t)}finally{m(t=>({...t,fetch:!1}))}})()},[]);const _=a=>{u({...o,[a.target.name]:a.target.value})},F=()=>{p(!0),j(null),u({category_name:"",category_code:"",sub_category_name:"",description:""})},N=()=>{p(!1)},P=a=>{u({category_name:a.category_name||"",category_code:a.category_code||"",sub_category_name:Array.isArray(a.sub_category_name)?a.sub_category_name.map(t=>t.name).join(", "):"",description:a.description||""}),j(a.category_code),p(!0)},M=async a=>{a.preventDefault(),m(n=>({...n,add:!0}));const t=[],i=/^[A-Za-z\s']+$/,r=/^[A-Za-z0-9-]+$/,s=/^[A-Za-z-,\s]+$/,H=/^[A-Za-z0-9-\s]+$/;if(o.category_name.trim()?i.test(o.category_name)||t.push("Category Name can only contain letters (A-Z, a-z), spaces, and apostrophes (')."):t.push("Category Name is required."),o.category_code.trim()?r.test(o.category_code)||t.push("Category Code can only contain letters, numbers, and hyphens (-)."):t.push("Category Code is required."),o.sub_category_name.trim()?s.test(o.sub_category_name)||t.push("Sub-Category Name can only contain letters, hyphens (-), commas (,), and spaces."):t.push("Sub-Category Name is required."),o.description.trim()&&!H.test(o.description)&&t.push("Description can only contain letters,disits, spaces, and hyphens (-)."),t.length>0){alert(`Validation Errors:
`+t.join(`
`)),m(n=>({...n,add:!1}));return}const O={...o,sub_category_name:o.sub_category_name.split(",").map(n=>({name:n.trim()}))};try{if(h!==null){const n=await f.put(`/api/user/categories/${o.category_name}/`,O);y(A=>({...A,[o.category_code]:n.data.data})),alert(n.data.message),j(null)}else{const n=await f.post("/api/user/categories/",O);y(A=>({...A,[n.data.data.category_code]:n.data.data})),alert(n.data.message)}}catch(n){console.error("Error saving category:",n)}finally{m(n=>({...n,add:!1})),u({category_name:"",category_code:"",sub_category_name:"",description:""}),p(!1)}},V=a=>{b(!0),U(a)},Y=async()=>{try{const a=g[K];if(!a){console.error("Error: Category not found for deletion.");return}await f.delete(`/api/user/categories/${a.category_name}/`);const i=Object.values(g).filter(r=>r.category_code!==a.category_code).reduce((r,s)=>(r[s.category_code]=s,r),{});y(i),alert("Category deleted successfully!")}catch(a){console.error("Error deleting category:",a)}finally{b(!1)}},R=()=>{b(!1)},D=(a,t)=>{a.key==="Enter"&&(a.preventDefault(),t!=null&&t.current&&t.current.focus())},G=()=>{const a=new ne;a.text("Category List",14,15);const t=["Category Name","Category Code","Sub-Category Names","Description"],i=Object.values(g).map(r=>[r.category_name,r.category_code,Array.isArray(r.sub_category_name)&&r.sub_category_name.length>0?r.sub_category_name.map(s=>(s==null?void 0:s.name)||"Unnamed Subcategory").join(", "):"No Subcategories",r.description]);a.autoTable({head:[t],body:i,startY:25}),a.save("category_list.pdf")};return e.jsxs(J,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(d,{variant:"contained",color:"secondary",onClick:F,children:h!==null?"Edit Category":"Add Category"}),e.jsxs(T,{open:W,onClose:N,children:[e.jsx(k,{children:h!==null?"Edit Category Details":"Add Category Details"}),e.jsx(L,{children:e.jsx($,{sx:{padding:"10px"},elevation:0,children:e.jsxs("form",{children:[e.jsx(x,{fullWidth:!0,label:"Category Name",name:"category_name",value:o.category_name,onChange:_,onKeyDown:a=>D(a,S),inputRef:B,margin:"normal",required:!0}),e.jsx(x,{fullWidth:!0,label:"Category Code",name:"category_code",value:o.category_code,onChange:_,onKeyDown:a=>D(a,v),inputRef:S,margin:"normal",required:!0}),e.jsx(x,{fullWidth:!0,label:"Sub-Category Names ",name:"sub_category_name",value:o.sub_category_name,onChange:_,onKeyDown:a=>D(a,E),inputRef:v,required:!0,margin:"normal"}),e.jsx(x,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:o.description,onChange:_,inputRef:E,margin:"normal"})]})})}),e.jsxs(q,{children:[e.jsx(d,{onClick:N,color:"error",children:"Cancel"}),e.jsx(d,{onClick:M,color:"secondary",disabled:C.add,children:C.add?e.jsx(z,{size:24}):h!==null?"Update":"Add"})]})]}),C.fetch?e.jsx(z,{}):e.jsx(Q,{component:$,sx:{marginTop:3},children:e.jsxs(X,{children:[e.jsx(ee,{children:e.jsxs(I,{children:[e.jsx(l,{children:"Category Name"}),e.jsx(l,{children:"Category Code"}),e.jsx(l,{children:"Sub-Category Names"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"Actions"}),e.jsx(l,{children:e.jsx(w,{color:"primary",onClick:G,children:e.jsx(se,{})})})]})}),e.jsx(ae,{children:Object.values(g).map(a=>e.jsxs(I,{children:[e.jsx(l,{children:a.category_name}),e.jsx(l,{children:a.category_code}),e.jsx(l,{style:{width:"350px",overflow:"hidden",textOverflow:"ellipsis"},children:Array.isArray(a.sub_category_name)&&a.sub_category_name.length>0?a.sub_category_name.map(t=>(t==null?void 0:t.name)||"Unnamed Subcategory").join(", "):"No Subcategories"}),e.jsx(l,{children:a.description}),e.jsxs(l,{children:[e.jsx(w,{color:"secondary",onClick:()=>P(a),children:e.jsx(te,{})}),e.jsx(w,{color:"error",onClick:()=>V(a.category_code),children:e.jsx(oe,{})})]})]},a.category_code))})]})}),e.jsxs(T,{open:Z,onClose:R,children:[e.jsx(k,{children:"Confirm Delete"}),e.jsx(L,{children:e.jsx(re,{children:"Are you sure you want to delete this category?"})}),e.jsxs(q,{children:[e.jsx(d,{onClick:R,color:"secondary",children:"CANCEL"}),e.jsx(d,{onClick:Y,color:"error",children:"CONFIRM"})]})]})]})}export{de as default};
