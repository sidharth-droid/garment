import{r,j as e,J as Y,K as x,M as A,O as w,Q as N,S as P,a6 as H,a7 as J,a8 as Q,a9 as T,U as I,V as R,W as X,X as ee,Y as ne,Z as se,_ as L,$ as l,a0 as C,a1 as te,a2 as re,a3 as le,G as p}from"./index-D56_o9iE.js";import{E as oe}from"./jspdf.plugin.autotable-DwG2OO1T.js";import{D as ie}from"./Download-BcoFGlUQ.js";function ue(){const[t,h]=r.useState({tax_name:"",tax_percentage:"",description:""}),[o,y]=r.useState([]),[D,i]=r.useState({add:!1}),[G,u]=r.useState(!1),[c,f]=r.useState(null),[m,O]=r.useState(null),[B,g]=r.useState(!1),W=r.useRef(null),b=r.useRef(null),_=r.useRef(null),S=async()=>{try{i(n=>({...n,fetch:!0}));const a=await p.get("/api/user/taxes/");y(a.data.data)}catch(a){console.error("Error fetching tax list",a)}finally{i(a=>({...a,fetch:!1}))}};r.useEffect(()=>{S()},[]);const j=a=>{h({...t,[a.target.name]:a.target.value})},k=(a,n)=>{a.key==="Enter"&&(a.preventDefault(),n!=null&&n.current&&n.current.focus())},q=()=>{u(!0),f(null)},E=()=>{u(!1)},K=async a=>{a.preventDefault(),i(s=>({...s,add:!0}));const n=[],d=/^[A-Za-z-\s]+$/,M=/^[A-Za-z0-9-\s,]+$/;if(t.tax_name.trim()?d.test(t.tax_name)||n.push("Tax Name can only contain letters, hyphens (-), and spaces."):n.push("Tax Name is required."),t.tax_percentage?(isNaN(t.tax_percentage)||t.tax_percentage<0)&&n.push("Tax Percentage must be a valid positive number."):n.push("Tax Percentage is required."),t.description.trim()&&!M.test(t.description)&&n.push("Description can only contain letters, numbers, spaces, hyphens (-), and commas (,)."),n.length>0){alert(`Validation Errors:
`+n.join(`
`)),i(s=>({...s,add:!1}));return}try{let s;c!==null?(s=await p.put(`/api/user/taxes/${o[c].id}/`,t),alert(s.data.message)):(s=await p.post("/api/user/taxes/",t),alert(s.data.message)),S(),h({tax_name:"",tax_percentage:"",description:""}),f(null),u(!1)}catch(s){if(console.error("Error adding/updating tax:",s),s.response&&s.response.data&&s.response.data.error){const V=Object.values(s.response.data.error).flat().join(`
`);alert(`Backend Error:
${V}`)}else alert("An unexpected error occurred. Please try again.")}finally{i(s=>({...s,add:!1}))}},z=a=>{h(o[a]),f(a),u(!0)},F=a=>{O(a),g(!0)},U=async()=>{try{await p.delete(`/api/user/taxes/${o[m].id}`);const a=o.filter((n,d)=>d!==m);y(a),console.log("Deleted tax at index",m),ae%$%$,g(!1)}catch(a){console.error("Error deleting tax",a)}},v=()=>{g(!1)},Z=()=>{const a=new oe;a.text("Tax List Report",14,15),a.autoTable({startY:25,head:[["#","Tax Name","Tax Percentage","Description"]],body:(Array.isArray(o)?o:[]).map((n,d)=>[d+1,n.tax_name,n.tax_percentage+" %",n.description]),theme:"striped"}),a.save("Tax_List.pdf")};return e.jsxs(Y,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(x,{variant:"contained",color:"secondary",onClick:q,children:c!==null?"Edit Tax":"Add Tax"}),e.jsxs(A,{open:G,onClose:E,children:[e.jsx(w,{style:{backgroundColor:"#f9dff5"},children:c!==null?"Edit Tax Details":"Add Tax Details"}),e.jsx(N,{style:{backgroundColor:"#f9dff5"},children:e.jsx(P,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(H,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(J,{children:"Tax Name"}),e.jsxs(Q,{value:t.tax_name,name:"tax_name",onChange:j,label:"Tax Name",inputRef:W,onKeyDown:a=>k(a,b),children:[e.jsx(T,{value:"CGST",children:"CGST"}),e.jsx(T,{value:"SGST",children:"SGST"}),e.jsx(T,{value:"IGST",children:"IGST"})]})]}),e.jsx(I,{fullWidth:!0,label:"Tax Percentage",name:"tax_percentage",value:t.tax_percentage,onChange:j,margin:"normal",required:!0,inputRef:b,onKeyDown:a=>k(a,_)}),e.jsx(I,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:t.description,onChange:j,margin:"normal",inputRef:_})]})})}),e.jsxs(R,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(x,{onClick:E,color:"error",children:"Cancel"}),e.jsx(x,{onClick:K,color:"secondary",disabled:D.add,children:D.add?e.jsx(X,{size:24}):c!==null?"Update":"Add"})]})]}),e.jsx(ee,{component:P,sx:{marginTop:3},children:e.jsxs(ne,{children:[e.jsx(se,{children:e.jsxs(L,{children:[e.jsx(l,{children:"Tax Name"}),e.jsx(l,{children:"Tax Percentage"}),e.jsx(l,{children:"Description"}),e.jsx(l,{children:"Actions"}),e.jsx(l,{children:e.jsx(C,{color:"primary",onClick:Z,children:e.jsx(ie,{})})})]})}),e.jsx(te,{children:(Array.isArray(o)?o:[]).map((a,n)=>e.jsxs(L,{children:[e.jsx(l,{children:a.tax_name}),e.jsx(l,{children:a.tax_percentage}),e.jsx(l,{children:a.description}),e.jsxs(l,{children:[e.jsx(C,{color:"secondary",onClick:()=>z(n),children:e.jsx(re,{})}),e.jsx(C,{color:"error",onClick:()=>F(n),children:e.jsx(le,{})})]})]},n))})]})}),e.jsxs(A,{open:B,onClose:v,children:[e.jsx(w,{children:"Confirm Delete"}),e.jsx(N,{children:"Are you sure you want to delete this tax entry?"}),e.jsxs(R,{children:[e.jsx(x,{onClick:v,color:"secondary",children:"Cancel"}),e.jsx(x,{onClick:U,color:"error",children:"Confirm"})]})]})]})}export{ue as default};
