import{af as we,ag as Se,ah as Pe,aj as Me,r as y,ak as Ce,ar as Ie,j as n,as as De,am as Ne,ad as Y,ai as me,an as Ae,g as Te,at as Fe,aa as ye,ab as ve,S as fe,a6 as Q,a7 as X,a8 as ee,a9 as R,J as le,a0 as re,T as D,U as S,K as ue,au as Re,ac as Oe,av as Ee,X as ke,Y as We,Z as Ue,_ as ce,$ as W,a1 as ze,G as K}from"./index-CazraW2q.js";import{C as Le}from"./Container-BSE63Jy1.js";import{P as Be}from"./Print-CmDghgSd.js";function qe(r){return we("MuiInputAdornment",r)}const Ye=Se("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]),ge=Ye;var xe;const He=(r,b)=>{const{ownerState:f}=r;return[b.root,b[`position${me(f.position)}`],f.disablePointerEvents===!0&&b.disablePointerEvents,b[f.variant]]},Ke=r=>{const{classes:b,disablePointerEvents:f,hiddenLabel:g,position:N,size:j,variant:_}=r,O={root:["root",f&&"disablePointerEvents",N&&`position${me(N)}`,_,g&&"hiddenLabel",j&&`size${me(j)}`]};return Ae(O,qe,b)},Ge=Pe("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:He})(Me(({theme:r})=>({display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(r.vars||r).palette.action.active,variants:[{props:{variant:"filled"},style:{[`&.${ge.positionStart}&:not(.${ge.hiddenLabel})`]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}))),de=y.forwardRef(function(b,f){const g=Ce({props:b,name:"MuiInputAdornment"}),{children:N,className:j,component:_="div",disablePointerEvents:O=!1,disableTypography:z=!1,position:A,variant:B,...M}=g,L=Ie()||{};let P=B;B&&L.variant,L&&!P&&(P=L.variant);const E={...g,hiddenLabel:L.hiddenLabel,size:L.size,disablePointerEvents:O,position:A,variant:P},G=Ke(E);return n.jsx(De.Provider,{value:null,children:n.jsx(Ge,{as:_,ownerState:E,className:Ne(G.root,j),ref:f,...M,children:typeof N=="string"&&!z?n.jsx(Y,{color:"textSecondary",children:N}):n.jsxs(y.Fragment,{children:[A==="start"?xe||(xe=n.jsx("span",{className:"notranslate","aria-hidden":!0,children:"â€‹"})):null,N]})})})});var be={exports:{}};(function(r,b){(function(f,g){r.exports=g()})(Fe,function(){var f=1e3,g=6e4,N=36e5,j="millisecond",_="second",O="minute",z="hour",A="day",B="week",M="month",L="quarter",P="year",E="date",G="Invalid Date",ie=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,se=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,oe={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var s=["th","st","nd","rd"],i=c%100;return"["+c+(s[(i-20)%10]||s[i]||s[0])+"]"}},te=function(c,s,i){var u=String(c);return!u||u.length>=s?c:""+Array(s+1-u.length).join(i)+c},C={s:te,z:function(c){var s=-c.utcOffset(),i=Math.abs(s),u=Math.floor(i/60),e=i%60;return(s<=0?"+":"-")+te(u,2,"0")+":"+te(e,2,"0")},m:function c(s,i){if(s.date()<i.date())return-c(i,s);var u=12*(i.year()-s.year())+(i.month()-s.month()),e=s.clone().add(u,M),a=i-e<0,t=s.clone().add(u+(a?-1:1),M);return+(-(u+(i-e)/(a?e-t:t-e))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M,y:P,w:B,d:A,D:E,h:z,m:O,s:_,ms:j,Q:L}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},q="en",v={};v[q]=oe;var T="$isDayjsObject",V=function(c){return c instanceof k||!(!c||!c[T])},J=function c(s,i,u){var e;if(!s)return q;if(typeof s=="string"){var a=s.toLowerCase();v[a]&&(e=a),i&&(v[a]=i,e=a);var t=s.split("-");if(!e&&t.length>1)return c(t[0])}else{var l=s.name;v[l]=s,e=l}return!u&&e&&(q=e),e||!u&&q},x=function(c,s){if(V(c))return c.clone();var i=typeof s=="object"?s:{};return i.date=c,i.args=arguments,new k(i)},m=C;m.l=J,m.i=V,m.w=function(c,s){return x(c,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var k=function(){function c(i){this.$L=J(i.locale,null,!0),this.parse(i),this.$x=this.$x||i.x||{},this[T]=!0}var s=c.prototype;return s.parse=function(i){this.$d=function(u){var e=u.date,a=u.utc;if(e===null)return new Date(NaN);if(m.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){var t=e.match(ie);if(t){var l=t[2]-1||0,o=(t[7]||"0").substring(0,3);return a?new Date(Date.UTC(t[1],l,t[3]||1,t[4]||0,t[5]||0,t[6]||0,o)):new Date(t[1],l,t[3]||1,t[4]||0,t[5]||0,t[6]||0,o)}}return new Date(e)}(i),this.init()},s.init=function(){var i=this.$d;this.$y=i.getFullYear(),this.$M=i.getMonth(),this.$D=i.getDate(),this.$W=i.getDay(),this.$H=i.getHours(),this.$m=i.getMinutes(),this.$s=i.getSeconds(),this.$ms=i.getMilliseconds()},s.$utils=function(){return m},s.isValid=function(){return this.$d.toString()!==G},s.isSame=function(i,u){var e=x(i);return this.startOf(u)<=e&&e<=this.endOf(u)},s.isAfter=function(i,u){return x(i)<this.startOf(u)},s.isBefore=function(i,u){return this.endOf(u)<x(i)},s.$g=function(i,u,e){return m.u(i)?this[u]:this.set(e,i)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(i,u){var e=this,a=!!m.u(u)||u,t=m.p(i),l=function(U,F){var H=m.w(e.$u?Date.UTC(e.$y,F,U):new Date(e.$y,F,U),e);return a?H:H.endOf(A)},o=function(U,F){return m.w(e.toDate()[U].apply(e.toDate("s"),(a?[0,0,0,0]:[23,59,59,999]).slice(F)),e)},d=this.$W,p=this.$M,h=this.$D,w="set"+(this.$u?"UTC":"");switch(t){case P:return a?l(1,0):l(31,11);case M:return a?l(1,p):l(0,p+1);case B:var I=this.$locale().weekStart||0,$=(d<I?d+7:d)-I;return l(a?h-$:h+(6-$),p);case A:case E:return o(w+"Hours",0);case z:return o(w+"Minutes",1);case O:return o(w+"Seconds",2);case _:return o(w+"Milliseconds",3);default:return this.clone()}},s.endOf=function(i){return this.startOf(i,!1)},s.$set=function(i,u){var e,a=m.p(i),t="set"+(this.$u?"UTC":""),l=(e={},e[A]=t+"Date",e[E]=t+"Date",e[M]=t+"Month",e[P]=t+"FullYear",e[z]=t+"Hours",e[O]=t+"Minutes",e[_]=t+"Seconds",e[j]=t+"Milliseconds",e)[a],o=a===A?this.$D+(u-this.$W):u;if(a===M||a===P){var d=this.clone().set(E,1);d.$d[l](o),d.init(),this.$d=d.set(E,Math.min(this.$D,d.daysInMonth())).$d}else l&&this.$d[l](o);return this.init(),this},s.set=function(i,u){return this.clone().$set(i,u)},s.get=function(i){return this[m.p(i)]()},s.add=function(i,u){var e,a=this;i=Number(i);var t=m.p(u),l=function(p){var h=x(a);return m.w(h.date(h.date()+Math.round(p*i)),a)};if(t===M)return this.set(M,this.$M+i);if(t===P)return this.set(P,this.$y+i);if(t===A)return l(1);if(t===B)return l(7);var o=(e={},e[O]=g,e[z]=N,e[_]=f,e)[t]||1,d=this.$d.getTime()+i*o;return m.w(d,this)},s.subtract=function(i,u){return this.add(-1*i,u)},s.format=function(i){var u=this,e=this.$locale();if(!this.isValid())return e.invalidDate||G;var a=i||"YYYY-MM-DDTHH:mm:ssZ",t=m.z(this),l=this.$H,o=this.$m,d=this.$M,p=e.weekdays,h=e.months,w=e.meridiem,I=function(F,H,Z,ae){return F&&(F[H]||F(u,a))||Z[H].slice(0,ae)},$=function(F){return m.s(l%12||12,F,"0")},U=w||function(F,H,Z){var ae=F<12?"AM":"PM";return Z?ae.toLowerCase():ae};return a.replace(se,function(F,H){return H||function(Z){switch(Z){case"YY":return String(u.$y).slice(-2);case"YYYY":return m.s(u.$y,4,"0");case"M":return d+1;case"MM":return m.s(d+1,2,"0");case"MMM":return I(e.monthsShort,d,h,3);case"MMMM":return I(h,d);case"D":return u.$D;case"DD":return m.s(u.$D,2,"0");case"d":return String(u.$W);case"dd":return I(e.weekdaysMin,u.$W,p,2);case"ddd":return I(e.weekdaysShort,u.$W,p,3);case"dddd":return p[u.$W];case"H":return String(l);case"HH":return m.s(l,2,"0");case"h":return $(1);case"hh":return $(2);case"a":return U(l,o,!0);case"A":return U(l,o,!1);case"m":return String(o);case"mm":return m.s(o,2,"0");case"s":return String(u.$s);case"ss":return m.s(u.$s,2,"0");case"SSS":return m.s(u.$ms,3,"0");case"Z":return t}return null}(F)||t.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(i,u,e){var a,t=this,l=m.p(u),o=x(i),d=(o.utcOffset()-this.utcOffset())*g,p=this-o,h=function(){return m.m(t,o)};switch(l){case P:a=h()/12;break;case M:a=h();break;case L:a=h()/3;break;case B:a=(p-d)/6048e5;break;case A:a=(p-d)/864e5;break;case z:a=p/N;break;case O:a=p/g;break;case _:a=p/f;break;default:a=p}return e?a:m.a(a)},s.daysInMonth=function(){return this.endOf(M).$D},s.$locale=function(){return v[this.$L]},s.locale=function(i,u){if(!i)return this.$L;var e=this.clone(),a=J(i,u,!0);return a&&(e.$L=a),e},s.clone=function(){return m.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},c}(),ne=k.prototype;return x.prototype=ne,[["$ms",j],["$s",_],["$m",O],["$H",z],["$W",A],["$M",M],["$y",P],["$D",E]].forEach(function(c){ne[c[1]]=function(s){return this.$g(s,c[0],c[1])}}),x.extend=function(c,s){return c.$i||(c(s,k,x),c.$i=!0),x},x.locale=J,x.isDayjs=V,x.unix=function(c){return x(1e3*c)},x.en=v[q],x.Ls=v,x.p={},x})})(be);var Je=be.exports;const Ve=Te(Je);var pe={},Ze=ve;Object.defineProperty(pe,"__esModule",{value:!0});var je=pe.default=void 0;et(y);var Qe=Ze(ye()),Xe=n;function $e(r){if(typeof WeakMap!="function")return null;var b=new WeakMap,f=new WeakMap;return($e=function(g){return g?f:b})(r)}function et(r,b){if(r&&r.__esModule)return r;if(r===null||typeof r!="object"&&typeof r!="function")return{default:r};var f=$e(b);if(f&&f.has(r))return f.get(r);var g={__proto__:null},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in r)if(j!=="default"&&{}.hasOwnProperty.call(r,j)){var _=N?Object.getOwnPropertyDescriptor(r,j):null;_&&(_.get||_.set)?Object.defineProperty(g,j,_):g[j]=r[j]}return g.default=r,f&&f.set(r,g),g}je=pe.default=(0,Qe.default)((0,Xe.jsx)("path",{d:"M16.75 13.96c.25.13.41.2.46.3.06.11.04.61-.21 1.18-.2.56-1.24 1.1-1.7 1.12-.46.02-.47.36-2.96-.73-2.49-1.09-3.99-3.75-4.11-3.92-.12-.17-.96-1.38-.92-2.61.05-1.22.69-1.8.95-2.04.24-.26.51-.29.68-.26h.47c.15 0 .36-.06.55.45l.69 1.87c.06.13.1.28.01.44l-.27.41-.39.42c-.12.12-.26.25-.12.5.12.26.62 1.09 1.32 1.78.91.88 1.71 1.17 1.95 1.3.24.14.39.12.54-.04l.81-.94c.19-.25.35-.19.58-.11l1.67.88M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10c-1.97 0-3.8-.57-5.35-1.55L2 22l1.55-4.65A9.969 9.969 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8c0 1.72.54 3.31 1.46 4.61L4.5 19.5l2.89-.96A7.95 7.95 0 0 0 12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8z"}),"WhatsApp");var he={},tt=ve;Object.defineProperty(he,"__esModule",{value:!0});var _e=he.default=void 0,nt=tt(ye()),at=n;_e=he.default=(0,nt.default)((0,at.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M9 11H7V9h2zm4 0h-2V9h2zm4 0h-2V9h2z"}),"Sms");function ot(){const[r,b]=y.useState({fullName:"",number:"",address:"",tax:"",discount:"",totalPrice:"",paymentMethod1:"Cash",paymentMethod2:"UPI",amount1:"",amount2:"",saletype:"RetailSale",narration:""}),[f,g]=y.useState([{barcode:"",category:"",sub_category:"",size:"",item_name:"",unit:"1",unit_price:"0.00"}]),N=y.useRef(""),[j,_]=y.useState(!1);y.useState(null);const O=Ve().format("YYYY-MM-DD HH:mm:ss"),[z,A]=y.useState(!1),[B,M]=y.useState(0),[L,P]=y.useState([]),[E,G]=y.useState([]),[ie,se]=y.useState(null),[oe,te]=y.useState(!1),[C,q]=y.useState([]),v=y.useRef([]);y.useEffect(()=>{console.log("ðŸ”„ Updated Preview Items:",C)},[C]);const T=e=>{const{name:a,value:t}=e.target;b(l=>{const o={...l,[a]:t};return a==="amount1"&&t!==""&&i(),o})};y.useEffect(()=>{(async()=>{try{const a=await K.get("api/user/taxes/");a.data&&Array.isArray(a.data.data)?P(a.data.data):(console.error("Unexpected API response:",a.data),P([]))}catch(a){console.error("Error fetching tax data:",a),P([])}})()},[]);const V=async()=>{if(r.number.length<10){alert("Please enter a valid phone number");return}try{const e=await K.post("api/retailsale/phone/",{phone_number:r.number});e.data&&b(a=>({...a,fullName:e.data.fullname||"",address:e.data.address||""}))}catch(e){console.error("Error fetching data:",e),alert("Failed to fetch data")}};y.useEffect(()=>{(async()=>{var t;const a=f[f.length-1];if(!(!a||!a.barcode||a.barcode===N.current)){N.current=a.barcode;try{console.log("Fetching data for barcode:",a.barcode);const l=await K.get(`api/barcode/get-barcode-details/${a.barcode}/`);if(console.log("API Response:",l.data),(t=l.data)!=null&&t.item_details){const{item_name:o,item_price:d,category_name:p,sub_category:h,item_size:w}=l.data.item_details;g(I=>I.map(($,U)=>U===I.length-1?{...$,item_name:o||$.item_name,unit_price:d||$.unit_price,category:p||$.category,sub_category:h||$.sub_category,size:w||$.size}:$))}}catch(l){console.error("Error fetching data:",l)}}})()},[f]),y.useEffect(()=>{const e=async()=>{try{if(C.length===0)return;const a=C.reduce((o,d)=>o+Number(d.total_item_price||0),0),t={grand_total:a,discount:r.discount?Number(r.discount):0,tax:r.tax?Number(r.tax):0};console.log("Sending request data:",t),b(o=>({...o,totalPrice:Number(parseFloat(a).toFixed(2))}));const l=await K.post("api/retailsale/calculate-total-price/",t);console.log("API Response:",l.data),l.data&&l.data.total_price!==void 0&&b(o=>({...o,totalPrice:Number(parseFloat(l.data.total_price).toFixed(2))}))}catch(a){console.error("Error fetching total price:",a)}};C.length>0&&e()},[C,r.tax,r.discount]);const J=(e,a)=>{let t=[];e.fullName.trim()||t.push("âš ï¸ Full Name is required."),e.number.trim()||t.push("âš ï¸ Phone Number is required."),e.address.trim()||t.push("âš ï¸ Address is required."),e.tax||t.push("âš ï¸ Tax is required."),e.paymentMethod1.trim()||t.push("âš ï¸ Payment Method 1 is required."),e.amount1||t.push("âš ï¸ Payment Method 1 Amount is required."),e.paymentMethod2.trim()||t.push("âš ï¸ Payment Method 2 is required."),e.amount2||t.push("âš ï¸ Payment Method 2 Amount is required."),e.saletype.trim()||t.push("âš ï¸ Sale Type is required."),a.length===0&&t.push("âš ï¸ No items added! Please add at least one item.");const l=/^[0-9]{10}$/,o=/^\d+(\.\d{1,2})?$/,d=/^\d+(\.\d{1,2})?$/;return l.test(e.number.trim())||t.push("âš ï¸ Phone Number must be 10 digits."),o.test(e.tax)||t.push("âš ï¸ Tax must be a valid number with up to 2 decimal places."),d.test(e.amount1)||t.push("âš ï¸ Payment Method 1 Amount must be a valid number with up to 2 decimal places."),d.test(e.amount2)||t.push("âš ï¸ Payment Method 2 Amount must be a valid number with up to 2 decimal places."),a.forEach((p,h)=>{p.barcode.trim()||t.push(`âš ï¸ Item ${h+1}: Barcode is required.`),p.category.trim()||t.push(`âš ï¸ Item ${h+1}: Category is required.`),p.sub_category.trim()||t.push(`âš ï¸ Item ${h+1}: Sub-Category is required.`),p.item_name.trim()||t.push(`âš ï¸ Item ${h+1}: Item Name is required.`),(!p.unit_price||!d.test(p.unit_price))&&t.push(`âš ï¸ Item ${h+1}: Unit Price must be a valid number.`)}),t.length>0?(alert(t.join(`
`)),!1):!0},x=async(e,a)=>{var l;if(e.preventDefault(),!J(r,C))return;if(!a){console.error("âŒ msgVia is not defined"),alert("Please select WhatsApp or SMS before submitting.");return}const t={fullname:r.fullName.trim(),phone_number:r.number.trim(),address:r.address.trim(),tax:parseFloat(r.tax).toFixed(2),tax_type:"SGST",discount:r.discount?parseFloat(r.discount).toFixed(2):null,payment_method1:r.paymentMethod1.trim(),payment_method1_amount:parseFloat(r.amount1).toFixed(2),payment_method2:r.paymentMethod2.trim(),payment_method2_amount:parseFloat(r.amount2).toFixed(2),narration:r.narration.trim(),saletype:r.saletype.trim(),items:C.map(({barcode:o,category:d,sub_category:p,size:h,item_name:w,unit:I,unit_price:$})=>({barcode:(o==null?void 0:o.trim())||"",category:(d==null?void 0:d.trim())||"",sub_category:(p==null?void 0:p.trim())||"",size:(h==null?void 0:h.trim())||"",item_name:(w==null?void 0:w.trim())||"",unit:Number(I)||1,unit_price:$?parseFloat($).toFixed(2):"0.00"})),msg_via:a};try{const d=((l=(await K.post("api/retailsale/create-order/",t)).data)==null?void 0:l.bill_number)||null;se(d),alert(`âœ… Form submitted successfully! Bill Number: ${d}`),b({fullName:"",number:"",address:"",tax:"",discount:"",totalPrice:"",paymentMethod1:"Cash",paymentMethod2:"UPI",amount1:"",amount2:"",saletype:"RetailSale",narration:""}),q([]),g([{barcode:"",category:"",sub_category:"",size:"",item_name:"",unit:"1",unit_price:"0.00"}])}catch(o){if(console.error("âŒ Submission Error:",o.response?JSON.stringify(o.response.data,null,2):o.message),o.response&&o.response.data){const d=Object.values(o.response.data).flat();alert(`âŒ Submission failed:
${d.join(`
`)}`)}else alert(`âŒ Submission failed: ${o.message}`)}},m=(e,a)=>{if(e.key==="Enter"){e.preventDefault();const t=a+1;t<v.current.length&&v.current[t].focus()}},k=(e,a)=>{const{name:t,value:l}=a.target;g(o=>o.map((d,p)=>p===e?{...d,[t]:l}:d))},ne=()=>{if(f.length>0){const e=f[f.length-1];console.log("ðŸ“Œ Last item before adding:",e);const a=[];if(e.barcode||a.push("Barcode"),e.item_name||a.push("Item Name"),e.unit||a.push("Unit"),e.unit_price||a.push("Unit Price"),a.length>0){alert(`Please fill out the required fields: ${a.join(", ")}`);return}q(t=>[...t,{barcode:e.barcode,item_name:e.item_name||"",category:e.category||"",sub_category:e.sub_category||"",size:e.size||"",unit:Number(e.unit)||1,unit_price:Number(e.unit_price).toFixed(2)||"0.00"}]),g([{barcode:"",category:"",sub_category:"",size:"",item_name:"",unit:"1",unit_price:"0.00"}])}else alert("No items to add.")};y.useEffect(()=>{console.log("âœ… Updated Preview Items:",C)},[C]);const c=()=>{const e=window.open("","","height=600,width=800"),a=new Date().toLocaleString(),t=parseFloat(r.unitPrice)||0,l=parseFloat(r.tax)||0,o=parseFloat(r.discount)||0,p=(parseFloat(r.unit)||0)*t,h=p*l/100,w=p+h,I=j?w*o/100:0,$=w-I,U=`
    <html>
    <head>
      <title>Retail Sale Invoice</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 20px; padding: 0; color: blue; background-color: #f9f9f9; }
        hr { border: none; border-bottom: 2px solid blue; margin: 20px 0; }/
        .invoice-container { width: 100%; max-width: 600px; margin: auto; border: 1px solid #ccc; padding: 20px; background-color: #fff; }
        .header { text-align: center; padding: 20px 0; background-color: #4caf50; color: blue; }
        .header h1 { margin: 0; font-size: 24px; }
        .section { margin-bottom: 20px; }
        .section h2 { margin-bottom: 10px; font-size: 18px; color: #4caf50; }
        .section p { margin: 5px 0; font-size: 14px; }
        .table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .table th, .table td { border: 1px solid #ddd; padding: 10px; font-size: 14px; }
        .table th { background-color: #f2f2f2; text-align: left; }
        .footer { text-align: center; padding: 20px 0; background-color: #4caf50; color: blue; font-size: 14px; }
        .footer p { margin: 0;}
        .flex-container { display: flex; justify-content: space-between; align-items: center; }
        .left-info { text-align: left; }
        .right-info { text-align: right; }
        .right-info p { margin: 0; }
        .pricing-row {
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
          font-size: 14px;
        }
        .pricing-row span {
          padding: 0 10px;
        }
      </style>
    </head>
    <body>
      <div class="invoice-container">
        <div class="header">
          <h1>NAARI FASHIONS</h1>
          <h2>MARKET BUILDING UNIT-II</h2>
          <hr>
          <h2>GSTIN:21AXKPR9141G1ZD</h2>
          <br><br>
          <h4>Retail Invoice</h4>
        </div>

        <div class="section">
          <div class="flex-container">
            <div class="left-info">
              <p><strong>Full Name:</strong> ${r.fullName}</p>
              <p><strong>Number:</strong> ${r.number}</p>
            </div>
            <div class="right-info">
              <p><strong>Date:</strong> ${a}</p>
              <p><strong>Invoice Number:</strong> ${billNumberFromResponse||"N/A"}</p>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>Item Information</h2>
          <table class="table">
            <tr>
              <th>Sl#</th>
              <th>Particulars</th>
              <th>Qty</th>
              <th>Amount</th>
            </tr>
            <tr>
              <td>1</td>
              <td>${r.itemName}</td>
              <td>${r.unit}</td>
              <td>â‚¹${w.toFixed(2)}</td> <!-- Updated to show total after tax -->
            </tr>
          </table>
        </div>

        <div class="section">
          <h2>Pricing and Tax</h2>
          <div class="pricing-row">
            <span>Total</span>
            <span>${r.unit}</span>
            <span>â‚¹ ${w.toFixed(2)}</span>
          </div>
          <!--<div class="pricing-row">
            <span>Tax:</span>
            <span>${l}%</span>
            <span>+â‚¹${h.toFixed(2)}</span>
          </div>-->
          ${j?`
            <div class="pricing-row">
              <span>Discount:</span>
              <span>${r.discount}%</span>
              <span>-â‚¹${I.toFixed(2)}</span>
            </div>`:""}
          <div class="pricing-row">
            <span><strong>Net Payable:</strong></span>
            <span><strong>â‚¹${$.toFixed(2)}</strong></span>
          </div>
        </div>

        <div class="section">
          <h2>Payment and Narration</h2>
          <p><strong>Payment Method1:</strong> ${r.paymentMethod1} â‚¹ ${r.amount1||0}</p>
          <p><strong>Payment Method2:</strong> ${r.paymentMethod2} â‚¹ ${r.amount2||0}</p>
          <p><strong>Narration:</strong> ${r.narration}</p>
        </div>
        <div class="section">
        <h6>Terms & Condition</h6>
        <hr>
        <ul>
        <li>No cash return</li>
        <li>No Exchange without Bill</li>
        <li>Exchange within 7 days</li>
        <li>No Exchange on Satureday and Sunday</li>
        <li>Exchange within 12 p.m to 4 p.m only</li>
        <li>No Colour Guarantee on any item</li>
        </ul>
        </div>

        <div class="footer">
          <p>Thank you visit again!</p>
        </div>
      </div>
    </body>
    </html>
  `;e.document.open(),e.document.write(U),e.document.close(),e.print()},s=async()=>{if(C.length===0){alert("No items to preview.");return}try{const e=C.map(({item_name:t,unit:l,unit_price:o})=>({item_name:t.trim(),unit:parseFloat(l)||1,unit_price:parseFloat(o)||0})),a=await K.post("api/retailsale/item-preview/",{items:e});console.log("âœ… API Response:",a.data),a.data&&a.data.created_items?(q(t=>t.map((l,o)=>{var d,p,h;return{...l,unit:((d=a.data.created_items[o])==null?void 0:d.unit)||l.unit,unit_price:((p=a.data.created_items[o])==null?void 0:p.unit_price)||l.unit_price,total_item_price:((h=a.data.created_items[o])==null?void 0:h.total_item_price)||"0.00"}})),G(a.data.created_items.map((t,l)=>{var o;return{barcode:((o=C[l])==null?void 0:o.barcode)||"",item_name:t.item_name,unit:t.unit,unit_price:t.unit_price,total_item_price:t.total_item_price||"0.00"}})),M(a.data.grand_total||0),A(!0)):(console.error("ðŸš¨ Unexpected API Response Structure:",a.data),alert("Unexpected response format. Please check the API."))}catch(e){console.error("âŒ Error fetching preview:",e.response?e.response.data:e.message),alert(`Error: ${e.response?JSON.stringify(e.response.data):e.message}`)}},i=async()=>{if(r.totalPrice)try{const e=await K.post("api/retailsale/calculate-payment-amount2/",{total_price:r.totalPrice,payment_method1_amount:r.amount1||"0"}),a=parseFloat(e.data.payment_method2_amount).toFixed(2);b(t=>({...t,amount2:a}))}catch(e){console.error("Error calculating Payment Amount 2:",e)}};y.useEffect(()=>{i()},[r.totalPrice,r.amount1]);const u=()=>A(!1);return n.jsx(Le,{maxWidth:"lg",sx:{backgroundColor:"#f9dff5",position:"relative"},children:n.jsxs(fe,{sx:{p:3,backgroundColor:"#f9dff5"},elevation:0,children:[n.jsx(Y,{variant:"h5",gutterBottom:!0,align:"center",color:"secondary",children:"SALE MODULE"}),n.jsxs(Y,{variant:"body2",color:"textSecondary",align:"center",children:["Sales Date & Time: ",O]}),n.jsxs(Q,{size:"small",sx:{minWidth:120},children:[n.jsx(X,{children:"Sale Type"}),n.jsxs(ee,{value:r.saletype,onChange:T,name:"saletype",label:"Sale Type",children:[n.jsx(R,{value:"RetailSale",children:"Retail Sale"}),n.jsx(R,{value:"BulkSale",children:"Bulk Sale"})]})]}),n.jsxs(le,{sx:{position:"absolute",top:16,right:16,display:"flex",gap:1},children:[n.jsx(re,{onClick:e=>x(e,"whatsapp"),sx:{color:"#25D366"},children:n.jsx(je,{})}),n.jsx(re,{onClick:e=>x(e,"sms"),sx:{color:"#370140"},children:n.jsx(_e,{})}),n.jsx(re,{onClick:c,sx:{color:"#370140"},children:n.jsx(Be,{})})]}),n.jsxs(le,{component:"form",onSubmit:x,sx:{mt:2},children:[n.jsxs(D,{container:!0,spacing:2,children:[n.jsxs(D,{item:!0,xs:12,md:3,children:[f.map((e,a)=>n.jsxs(D,{container:!0,spacing:2,style:{marginTop:"0.7px"},children:[n.jsxs(Y,{variant:"subtitle1",gutterBottom:!0,color:"textPrimary",children:["Item Information ",a+1]}),n.jsxs(D,{container:!0,spacing:2,alignItems:"center",children:[n.jsx(D,{item:!0,xs:6,children:n.jsx(S,{style:{width:"100%"},label:"Barcode",name:"barcode",value:e.barcode,onChange:t=>k(a,t),margin:"normal",variant:"outlined",inputRef:t=>v.current[0]=t,onKeyDown:t=>m(t,0)})}),n.jsx(D,{item:!0,xs:6,children:n.jsx(S,{style:{width:"100%"},label:"Item Name",name:"item_name",value:e.item_name,onChange:t=>k(a,t),margin:"normal",variant:"outlined"})})]}),n.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[n.jsx(S,{style:{width:"150px"},label:"Category",name:"category",value:e.category,onChange:t=>k(a,t),margin:"dense",variant:"outlined",inputRef:t=>v.current[2]=t,onKeyDown:t=>m(t,2)}),n.jsx(S,{style:{width:"120px"},label:"Sub-category",name:"sub_category",value:e.sub_category,onChange:t=>k(a,t),margin:"dense",variant:"outlined",inputRef:t=>v.current[3]=t,onKeyDown:t=>m(t,3)})]}),n.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[n.jsx(S,{style:{width:"150px"},label:"Size",name:"size",value:e.size,onChange:t=>k(a,t),margin:"dense",variant:"outlined",inputRef:t=>v.current[4]=t,onKeyDown:t=>m(t,4)}),n.jsx(S,{style:{width:"120px"},label:"Unit",name:"unit",value:e.unit,onChange:t=>k(a,t),margin:"dense",variant:"outlined",inputRef:t=>v.current[5]=t,onKeyDown:t=>m(t,5)})]}),n.jsx(S,{style:{width:"100%"},label:"Unit Price",name:"unit_price",value:e.unit_price,onChange:t=>k(a,t),margin:"normal",variant:"outlined",inputRef:t=>v.current[6]=t,onKeyDown:t=>m(t,6)}),a!==f.length-1&&n.jsx("hr",{style:{margin:"10px 0"}})]},a)),n.jsxs(D,{children:[n.jsx(ue,{variant:"contained",color:"secondary",onClick:ne,style:{marginTop:"20px",borderRadius:"50%",height:"60px",width:"60px",padding:0},children:n.jsx(Re,{style:{fontSize:"32px",fontWeight:"bold"}})}),n.jsx(ue,{variant:"outlined",color:"secondary",onClick:s,style:{marginTop:"20px",marginLeft:"20px"},children:"CHECK HERE"})]})]}),n.jsx(Oe,{open:z,onClose:u,children:n.jsxs(le,{sx:{bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",overflowY:"auto",maxHeight:"400px"},children:[n.jsxs(Y,{variant:"h6",component:"h2",gutterBottom:!0,style:{color:"secondary"},children:["Preview Items",n.jsx(re,{onClick:u,style:{float:"right"},children:n.jsx(Ee,{})})]}),E.length===0?n.jsx(Y,{variant:"body1",children:"No items added yet."}):n.jsx(ke,{component:fe,children:n.jsxs(We,{children:[n.jsx(Ue,{children:n.jsxs(ce,{children:[n.jsx(W,{style:{color:"secondary"},children:"Sl.No"}),n.jsx(W,{style:{color:"secondary"},children:"Item Name"}),n.jsx(W,{style:{color:"secondary"},children:"Unit"}),n.jsx(W,{style:{color:"secondary"},children:"Unit Price"}),n.jsx(W,{style:{color:"secondary"},children:"Total Item Price"})]})}),n.jsxs(ze,{children:[E.map((e,a)=>n.jsxs(ce,{children:[n.jsx(W,{style:{textAlign:"center",color:"secondary"},children:a+1}),n.jsx(W,{style:{textAlign:"center"},children:e.item_name}),n.jsx(W,{style:{textAlign:"center"},children:e.unit}),n.jsx(W,{style:{textAlign:"center"},children:parseFloat(e.unit_price).toFixed(2)}),n.jsx(W,{style:{textAlign:"center"},children:e.total_item_price})]},a)),n.jsxs(ce,{children:[n.jsx(W,{colSpan:4,align:"right",children:n.jsx("strong",{children:"Grand Total:"})}),n.jsx(W,{style:{textAlign:"center"},children:parseFloat(B).toFixed(2)})]})]})]})})]})}),n.jsxs(D,{item:!0,xs:12,md:3,children:[n.jsx(Y,{variant:"subtitle1",gutterBottom:!0,color:"textPrimary",children:"Customer Information"}),n.jsx(S,{fullWidth:!0,label:"Number",name:"number",value:r.number,onChange:T,onBlur:V,margin:"normal",type:"tel",variant:"outlined"}),n.jsx(S,{fullWidth:!0,label:"Full Name",name:"fullName",value:r.fullName,onChange:T,margin:"normal",variant:"outlined"}),n.jsx(S,{fullWidth:!0,multiline:!0,rows:4,label:"Address",name:"address",value:r.address,onChange:T,margin:"normal",variant:"outlined"}),n.jsx(S,{label:"Bill Number",name:"bill_number",value:oe?"Generating Bill Number...":ie||"",variant:"outlined",margin:"normal",style:{width:"200px",fontWeight:"bold"},InputProps:{readOnly:!0}})]}),n.jsxs(D,{item:!0,xs:12,md:3,children:[n.jsx(Y,{variant:"subtitle1",gutterBottom:!0,color:"textPrimary",children:"Pricing and Tax"}),n.jsxs(Q,{fullWidth:!0,margin:"normal",variant:"outlined",children:[n.jsx(X,{children:"Tax Type"}),n.jsx(ee,{name:"taxType",value:r.taxType,onChange:T,label:"Tax Type",children:L.map(e=>n.jsx(R,{value:e.tax_name,children:e.tax_name},e.id))})]}),n.jsx(S,{fullWidth:!0,label:"Tax (%)",name:"tax",value:r.tax,onChange:T,margin:"normal",variant:"outlined",inputRef:e=>v.current[7]=e,onKeyDown:e=>m(e,7)}),n.jsxs(Q,{fullWidth:!0,margin:"normal",variant:"outlined",children:[n.jsx(X,{children:"Discount Applicable"}),n.jsxs(ee,{name:"isDiscountApplicable",value:j?"Yes":"No",onChange:e=>_(e.target.value==="Yes"),label:"Discount Applicable",children:[n.jsx(R,{value:"No",children:"No"}),n.jsx(R,{value:"Yes",children:"Yes"})]})]}),j&&n.jsx(S,{fullWidth:!0,label:"Discount (%)",name:"discount",value:r.discount,onChange:T,margin:"normal",type:"number",variant:"outlined",inputRef:e=>v.current[8]=e,onKeyDown:e=>m(e,8)}),n.jsx(S,{fullWidth:!0,label:"Total Price",name:"totalPrice",value:r.totalPrice,margin:"normal",InputProps:{readOnly:!0,startAdornment:n.jsx(de,{position:"start",children:"â‚¹"})},variant:"outlined",inputRef:e=>v.current[9]=e,onKeyDown:e=>m(e,9)})]}),n.jsxs(D,{item:!0,xs:12,md:3,children:[n.jsx(Y,{variant:"subtitle1",gutterBottom:!0,color:"textPrimary",children:"Payment and Narration"}),n.jsxs(D,{container:!0,spacing:2,children:[n.jsx(D,{item:!0,xs:6,children:n.jsxs(Q,{fullWidth:!0,margin:"normal",variant:"outlined",children:[n.jsx(X,{children:"Payment Method 1"}),n.jsxs(ee,{name:"paymentMethod1",value:r.paymentMethod1,onChange:T,label:"Payment Method 1",children:[n.jsx(R,{value:"Cash",children:"Cash"}),n.jsx(R,{value:"Credit Card",children:"Credit Card"}),n.jsx(R,{value:"Debit Card",children:"Debit Card"}),n.jsx(R,{value:"UPI",children:"UPI"})]})]})}),n.jsx(D,{item:!0,xs:6,children:n.jsx(S,{fullWidth:!0,label:"Payment Amount 1",name:"amount1",value:r.amount1,onChange:T,margin:"normal",InputProps:{startAdornment:n.jsx(de,{position:"start",children:"â‚¹"})},variant:"outlined",inputRef:e=>v.current[10]=e,onKeyDown:e=>m(e,10)})}),n.jsx(D,{item:!0,xs:6,children:n.jsxs(Q,{fullWidth:!0,margin:"normal",variant:"outlined",children:[n.jsx(X,{children:"Payment Method 2"}),n.jsxs(ee,{name:"paymentMethod2",value:r.paymentMethod2,onChange:T,label:"Payment Method 2",children:[n.jsx(R,{value:"Cash",children:"Cash"}),n.jsx(R,{value:"Credit Card",children:"Credit Card"}),n.jsx(R,{value:"Debit Card",children:"Debit Card"}),n.jsx(R,{value:"UPI",children:"UPI"})]})]})}),n.jsx(D,{item:!0,xs:6,children:n.jsx(S,{fullWidth:!0,label:"Payment Amount 2",name:"amount2",value:r.amount2,margin:"normal",InputProps:{startAdornment:n.jsx(de,{position:"start",children:"â‚¹"})},variant:"outlined"})})]}),n.jsx(S,{fullWidth:!0,multiline:!0,rows:4,label:"Narration",name:"narration",value:r.narration,onChange:T,margin:"normal",variant:"outlined",inputRef:e=>v.current[12]=e,onKeyDown:e=>m(e,12)})]})]}),n.jsx(ue,{type:"submit",variant:"contained",color:"secondary",fullWidth:!0,sx:{mt:2},children:"Submit"})]})]})})}export{ot as default};
