import{r as a,j as e,J as ae,K as g,M as O,O as z,Q as I,S as Z,T as d,U as u,a6 as le,a7 as te,a8 as oe,a9 as E,V as F,W as ie,X as de,Y as ce,Z as ue,_ as M,$ as t,a1 as me,a0 as P,a2 as fe,a3 as he,G as b}from"./index-D56_o9iE.js";function xe(){const[n,w]=a.useState({user_name:"",fullname:"",email:"",contact_number:"",role:"",password:"",password2:"",description:""}),[f,U]=a.useState([]),[A,h]=a.useState({add:!1}),[B,y]=a.useState(!1),[C,D]=a.useState(null),[L,R]=a.useState(!1),[V,G]=a.useState(null),H=a.useRef(null),v=a.useRef(null),k=a.useRef(null),N=a.useRef(null),$=a.useRef(null),p=a.useRef(null),K=a.useRef(null),q=a.useRef(null),S=async()=>{h(s=>({...s,fetch:!0}));try{const s=await b.get("api/user/userdetails/");U(s.data)}catch(s){console.error("Error fetching user data:",s)}finally{h(s=>({...s,fetch:!1}))}};a.useEffect(()=>{S()},[]);const c=s=>{w({...n,[s.target.name]:s.target.value})},J=()=>{y(!0),D(null)},W=()=>{y(!1)},Q=async s=>{s.preventDefault(),h(l=>({...l,add:!0}));const r=[],i=/^[A-Za-z0-9_@-]+$/,m=/^[A-Za-z\s]+$/,x=/^[0-9]{10}$/,j=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,_=/^[A-Za-z0-9\s_-]+$/;if(n.user_name.trim()?i.test(n.user_name)||r.push("Username can only contain letters, numbers, '_', '@', and '-'."):r.push("Username is required."),n.fullname.trim()?m.test(n.fullname)||r.push("Full Name can only contain letters and spaces."):r.push("Full Name is required."),n.contact_number.trim()?x.test(n.contact_number)||r.push("Contact Number must be exactly 10 digits."):r.push("Contact Number is required."),n.email.trim()?j.test(n.email)||r.push("Enter a valid email address."):r.push("Email is required."),n.description.trim()?_.test(n.description)||r.push("Description can only contain letters, numbers, spaces, '_', and '-'."):r.push("Description is required."),r.length>0){alert(`Validation Errors:
`+r.join(`
`)),h(l=>({...l,add:!1}));return}try{let l;C!==null?(l=await b.put(`api/user/userdetails/${n.user_name}/`,n),alert("User updated successfully.")):(l=await b.post("api/user/userdetails/",n),alert("User added successfully.")),S(),w({user_name:"",fullname:"",email:"",contact_number:"",role:"",password:"",password2:"",description:""}),D(null),y(!1)}catch(l){if(console.error("Error adding/updating user:",l),l.response&&l.response.data){const se=Object.entries(l.response.data).map(([re,ne])=>`${re}: ${ne.join(", ")}`).join(`
`);alert(`Backend Error:
${se}`)}else alert("An unexpected error occurred. Please try again.")}finally{h(l=>({...l,add:!1}))}},X=s=>{w(f[s]),D(s),y(!0)},Y=s=>{G(s),R(!0)},ee=async s=>{const r=f[s];if(!r||!r.user_name){alert("User details are missing.");return}try{const i=await b.delete(`api/user/userdetails/${r.user_name}/`),m=f.filter((x,j)=>j!==s);U(m),console.log("User deleted successfully:",m),alert("User deleted successfully.")}catch(i){if(console.error("Error deleting user:",i),i.response&&i.response.data&&i.response.data.error){const m=i.response.data.error;let x="";for(const[j,_]of Object.entries(m))x+=`${j.toUpperCase()}: ${_.join(", ")}
`;alert(`Validation Errors:
${x}`)}else alert(`Error: ${i.message||"An unknown error occurred."}`)}finally{R(!1)}},T=()=>{R(!1)},o=(s,r)=>{s.key==="Enter"&&(s.preventDefault(),r.current&&r.current.focus())};return e.jsxs(ae,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(g,{variant:"contained",color:"secondary",onClick:J,children:C!==null?"Edit User":"Add User"}),e.jsxs(O,{open:B,onClose:W,sx:{"& .MuiDialog-paper":{width:"800px",maxWidth:"none"}},children:[e.jsx(z,{style:{backgroundColor:"#f9dff5"},children:C!==null?"Edit User Details":"Add User Details"}),e.jsx(I,{style:{backgroundColor:"#f9dff5"},children:e.jsx(Z,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsx("form",{children:e.jsxs(d,{container:!0,spacing:1,children:[e.jsx(d,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"User Name",name:"user_name",value:n.user_name,onChange:c,margin:"normal",required:!0,inputRef:H,onKeyDown:s=>o(s,v)})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Full Name",name:"fullname",value:n.fullname,onChange:c,margin:"normal",required:!0,inputRef:v,onKeyDown:s=>o(s,k)})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Email Address",name:"email",type:"email",value:n.email,onChange:c,margin:"normal",required:!0,inputRef:k,onKeyDown:s=>o(s,N)})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Contact Number",name:"contact_number",value:n.contact_number,onChange:c,margin:"normal",required:!0,inputRef:N,onKeyDown:s=>o(s,$)})}),e.jsx(d,{item:!0,xs:6,children:e.jsxs(le,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(te,{children:"Role"}),e.jsxs(oe,{value:n.role,name:"role",onChange:c,label:"Role",inputRef:$,onKeyDown:s=>o(s,p),children:[e.jsx(E,{value:"Admin",onKeyDown:s=>o(s,p),children:" Admin"}),e.jsx(E,{value:"Manager",onKeyDown:s=>o(s,p),children:"Manager"}),e.jsx(E,{value:"Salesperson",onKeyDown:s=>o(s,p),children:"Salesperson"})]})]})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Password",name:"password",type:"password",value:n.password,onChange:c,margin:"normal",required:!0,inputRef:p,onKeyDown:s=>o(s,K)})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,label:"Confirm Password",name:"password2",type:"password",value:n.password2,onChange:c,margin:"normal",required:!0,inputRef:K,onKeyDown:s=>o(s,q)})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(u,{fullWidth:!0,multiline:!0,rows:4,label:"Description",name:"description",value:n.description,onChange:c,margin:"normal",inputRef:q,onKeyDown:s=>{s.key==="Enter"&&s.preventDefault()}})})]})})})}),e.jsxs(F,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(g,{onClick:W,color:"error",children:"Cancel"}),e.jsx(g,{onClick:Q,color:"secondary",disabled:A.add,children:A.add?e.jsx(ie,{size:24}):C!==null?"Update":"Add"})]})]}),e.jsx(de,{component:Z,sx:{marginTop:3},children:e.jsxs(ce,{children:[e.jsx(ue,{children:e.jsxs(M,{children:[e.jsx(t,{children:"User Name"}),e.jsx(t,{children:"Full Name"}),e.jsx(t,{children:"Email Address"}),e.jsx(t,{children:"Contact Number"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(me,{children:(Array.isArray(f)?f:[]).map((s,r)=>e.jsxs(M,{children:[e.jsx(t,{children:s.user_name}),e.jsx(t,{children:s.fullname}),e.jsx(t,{children:s.email}),e.jsx(t,{children:s.contact_number}),e.jsx(t,{children:s.role}),e.jsxs(t,{children:[e.jsx(P,{color:"secondary",onClick:()=>X(r),children:e.jsx(fe,{})}),e.jsx(P,{color:"error",onClick:()=>Y(r),children:e.jsx(he,{})})]})]},r))})]})}),e.jsxs(O,{open:L,onClose:T,children:[e.jsx(z,{children:"Confirm Delete"}),e.jsx(I,{children:"Are you sure you want to delete this user?"}),e.jsxs(F,{children:[e.jsx(g,{onClick:T,color:"secondary",children:"Cancel"}),e.jsx(g,{onClick:()=>ee(V),color:"error",children:"Confirm"})]})]})]})}export{xe as default};
