import{aa as le,ab as ce,j as e,r,J as Ce,K as v,M as ee,O as te,Q as ae,T as l,a6 as Re,a7 as Ie,a8 as Pe,a9 as ne,W as Se,U as i,V as re,X as qe,S as Ee,Y as we,Z as Te,_ as se,$ as n,a1 as Ae,a0 as oe,G as j}from"./index-D56_o9iE.js";import{A as ke}from"./Alert-CP0wlLSr.js";var K={},We=ce;Object.defineProperty(K,"__esModule",{value:!0});var ie=K.default=void 0,Ve=We(le()),Fe=e;ie=K.default=(0,Ve.default)((0,Fe.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var L={},Be=ce;Object.defineProperty(L,"__esModule",{value:!0});var ue=L.default=void 0,Ke=Be(le()),Le=e;ue=L.default=(0,Ke.default)((0,Le.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");function Oe(){const[f,b]=r.useState({party_name:"",address:"",item:""}),[M,de]=r.useState([]),[N,O]=r.useState(!1),[D,E]=r.useState({voucher_number:"",voucher_date:""}),[x,_]=r.useState([]),[u,w]=r.useState({quantity:"",rate:"",discount_percentage:"",gst_percentage:"",discount_amount:0,taxable_amount:0,gst_amount:0,purchase_amount:0}),[he,T]=r.useState(!1),[$,d]=r.useState(""),[y,A]=r.useState(null),[me,C]=r.useState(!1),[k,W]=r.useState(null),pe=r.useRef(null),fe=r.useRef(null),z=r.useRef(null),G=r.useRef(null),H=r.useRef(null),Q=r.useRef(null),J=r.useRef(null),xe=r.useRef(null),ge=r.useRef(null),h=(t,a)=>{t.key==="Enter"&&(t.preventDefault(),a&&a.current&&a.current.focus())};r.useEffect(()=>{const t=async()=>{try{const s=await j.get("api/purchase/purchase-entry/");_(s.data.data)}catch(s){console.error("Error fetching data:",s)}};(async()=>{O(!0);try{const s=await j.get("/api/user/party/");de(s.data.data)}catch{d("Failed to load parties")}finally{O(!1)}})(),t()},[]);const V=t=>{const{name:a,value:s}=t.target;if(a==="party_name"){const c=M.find(g=>g.party_name===s);c&&b({...f,party_name:c.party_name,address:c.address,item:c.item||""})}else b({...f,[a]:s})},X=t=>{const{name:a,value:s}=t.target;E({...D,[a]:s})},R=t=>{const{name:a,value:s}=t.target,c={...u,[a]:s},g=parseFloat(c.quantity)||0,F=parseFloat(c.rate)||0,I=g*F,B=parseFloat(c.discount_percentage)/100*I,P=I-B,m=parseFloat(c.gst_percentage)/100*P,o=P+m;w({...c,discount_amount:B||0,taxable_amount:P||0,gst_amount:m||0,purchase_amount:o||0})},je=async()=>{d("");const{party_name:t,address:a,item:s}=f,{voucher_number:c,voucher_date:g}=D,{quantity:F,rate:I,discount_percentage:B,gst_percentage:P}=u;if(!t||!a||!c||!g||!F||!I||!s){alert("Please fill in all fields."),d("Please fill in all fields.");return}const m={...u,party_name:t,address:a,item:s,voucher_number:c,voucher_date:g};console.log("Saving Item:",JSON.stringify(m,null,2));try{let o;y!==null?o=await j.put(`api/purchase/purchase-entries/${m.party_name}/`,m):o=await j.post("api/purchase/purchase-entry/",m);const p=o.data;if(y!==null){const S=x.map((q,De)=>De===y?p:q);_(S),A(null)}else _([...x,p]);_e(),ye(),alert("✅ Item saved successfully!")}catch(o){console.error("Error saving data:",o);let p="Error saving data. Please try again.";if(o.response&&o.response.data)if(console.log("Error response data:",o.response.data),o.response.data.error){const S=o.response.data.error;p=Object.keys(S).map(q=>`${q}: ${S[q].join(", ")}`).join(`
`)}else o.response.data.detail&&(p=o.response.data.detail);alert("⚠️ "+p),d(p)}},_e=async()=>{try{const t=await j.get("api/purchase/purchase-entry/");_(t.data.data)}catch(t){console.error("Error fetching data:",t)}},ye=()=>{b({party_name:"",address:"",item:""}),E({voucher_number:"",voucher_date:""}),w({quantity:"",rate:"",discount_percentage:"",gst_percentage:"",discount_amount:0,taxable_amount:0,gst_amount:0,purchase_amount:0}),T(!1),d("")},U=(t=null)=>{if(t!==null){const a=x[t];w({quantity:a.quantity,rate:a.rate,discount_percentage:a.discount_percentage,gst_percentage:a.gst_percentage,discount_amount:a.discount_amount,taxable_amount:a.taxable_amount,gst_amount:a.gst_amount,purchase_amount:a.purchase_amount}),b({party_name:a.party_name,address:a.address,item:a.item}),E({voucher_number:a.voucher_number,voucher_date:a.voucher_date}),A(t)}else A(null);T(!0)},Y=()=>{T(!1),d("")},ve=t=>{W(t),C(!0)},Z=()=>{C(!1),W(null)},be=async()=>{if(k!==null){const t=x[k];try{await j.delete(`api/purchase/purchase-entries/${t.party_name}/`),_(x.filter((a,s)=>s!==k)),W(null),C(!1)}catch(a){console.error("Error deleting item:",a),d("Failed to delete the item. Please try again."),C(!1)}}};return e.jsxs(Ce,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(v,{variant:"contained",color:"secondary",onClick:()=>U(),children:y!==null?"Edit Purchase":"Add Purchase"}),e.jsxs(ee,{open:he,onClose:Y,maxWidth:"md",fullWidth:!0,children:[e.jsx(te,{style:{backgroundColor:"#f9dff5"},children:y!==null?"Edit Purchase":"Add Purchase"}),e.jsxs(ae,{style:{backgroundColor:"#f9dff5"},children:[$&&e.jsx(ke,{severity:"error",children:$}),e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsxs(Re,{fullWidth:!0,margin:"normal",children:[e.jsx(Ie,{children:"Party Name"}),e.jsx(Pe,{value:f.party_name,onChange:V,label:"Party Name",name:"party_name",required:!0,disabled:N,inputRef:pe,onKeyDown:t=>h(t,z),children:N?e.jsx(ne,{disabled:!0,children:e.jsx(Se,{size:24})}):M.map(t=>e.jsx(ne,{value:t.party_name,children:t.party_name},t.id))})]})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Address",name:"address",value:f.address,onChange:V,required:!0,margin:"normal",inputRef:fe,onKeyDown:t=>h(t,G)})})]}),e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Item",name:"item",value:f.item,onChange:V,required:!0,margin:"normal",inputRef:z,onKeyDown:t=>h(t,H)})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Voucher Number",name:"voucher_number",value:D.voucher_number,onChange:X,required:!0,margin:"normal",inputRef:G,onKeyDown:t=>h(t,Q)})})]}),e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Voucher Date",type:"date",name:"voucher_date",value:D.voucher_date,onChange:X,required:!0,margin:"normal",InputLabelProps:{shrink:!0},inputRef:H,onKeyDown:t=>h(t,J)})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Quantity",name:"quantity",value:u.quantity,onChange:R,required:!0,margin:"normal",inputRef:Q,onKeyDown:t=>h(t,xe)})})]}),e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Rate",name:"rate",value:u.rate,onChange:R,required:!0,margin:"normal",inputRef:J,onKeyDown:t=>h(t,ge)})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"Discount (%)",name:"discount_percentage",value:u.discount_percentage,onChange:R,margin:"normal"})})]}),e.jsx(l,{container:!0,spacing:2,marginBottom:2,children:e.jsx(l,{item:!0,xs:6,children:e.jsx(i,{fullWidth:!0,label:"GST (%)",name:"gst_percentage",value:u.gst_percentage,onChange:R,margin:"normal"})})})]}),e.jsxs(re,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(v,{onClick:je,color:"secondary",children:"Save"}),e.jsx(v,{onClick:Y,color:"error",children:"Cancel"})]})]}),e.jsxs(ee,{open:me,onClose:Z,children:[e.jsx(te,{children:"Confirm Deletion"}),e.jsx(ae,{children:"Are you sure you want to delete this item?"}),e.jsxs(re,{children:[e.jsx(v,{onClick:Z,color:"secondary",children:"Cancel"}),e.jsx(v,{onClick:be,color:"error",children:"Confirm"})]})]}),e.jsx(qe,{component:Ee,sx:{overflowX:"auto",marginTop:3},children:e.jsxs(we,{children:[e.jsx(Te,{children:e.jsxs(se,{children:[e.jsx(n,{children:"Party Name"}),e.jsx(n,{children:"Item"}),e.jsx(n,{children:"Voucher Number"}),e.jsx(n,{children:"Voucher Date"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Rate"}),e.jsx(n,{children:"Discount (%)"}),e.jsx(n,{children:"GST (%)"}),e.jsx(n,{children:"Discount Amount"}),e.jsx(n,{children:"Taxable Amount"}),e.jsx(n,{children:"GST Amount"}),e.jsx(n,{children:"Purchase Amount"}),e.jsx(n,{children:"Reference Voucher Number"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(Ae,{children:x.map((t,a)=>e.jsxs(se,{children:[e.jsx(n,{children:t.party_name}),e.jsx(n,{children:t.item}),e.jsx(n,{children:t.voucher_number}),e.jsx(n,{children:t.voucher_date}),e.jsx(n,{children:t.quantity}),e.jsx(n,{children:t.rate}),e.jsx(n,{children:t.discount_percentage}),e.jsx(n,{children:t.gst_percentage}),e.jsx(n,{children:t.discount_amount}),e.jsx(n,{children:t.taxable_amount}),e.jsx(n,{children:t.gst_amount}),e.jsx(n,{children:t.purchase_amount}),e.jsx(n,{children:t.reference_voucher_number}),e.jsxs(n,{children:[e.jsx(oe,{color:"secondary",onClick:()=>U(a),children:e.jsx(ue,{})}),e.jsx(oe,{color:"error",onClick:()=>ve(a),children:e.jsx(ie,{})})]})]},a))})]})})]})}export{Oe as default};
