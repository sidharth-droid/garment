import{r as i,G as v,j as e,J as b,K as x,M as B,O as D,Q as G,S as R,U as c,W as N,V as T,X as J,Y as M,Z as Q,_ as f,$ as n,a1 as V,R as X}from"./index-D56_o9iE.js";function Z(){const[d,A]=i.useState({bill_number:"",fullname:"",phone_number:"",address:""}),[g,j]=i.useState([{barcode:"",category:"",sub_category:"",size:"",item_name:""}]),[o,h]=i.useState({add:!1,fetch:!1}),[w,y]=i.useState(!1),[p,E]=i.useState(null),[F,C]=i.useState(!1),[S,z]=i.useState([]),[P,I]=i.useState([]);i.useEffect(()=>{L()},[]);const L=async()=>{h(a=>({...a,tableFetch:!0}));try{const a=await v.get("api/salesreturn/returns/"),r=Array.isArray(a.data.data)?a.data.data:[];console.log("Fetched data:",r);const s=r.map(l=>{var u,m,t;return{return_id:l.return_id||"N/A",full_name:((u=l.bill_number)==null?void 0:u.full_name)||"Unknown",phone_number:((m=l.bill_number)==null?void 0:m.phone_number)||"N/A",address:((t=l.bill_number)==null?void 0:t.address)||"N/A",items:l.items||[]}});console.log("Transformed data:",s),s.length>0&&z(s)}catch(a){console.error("Error fetching sales return data",a)}finally{h(a=>({...a,tableFetch:!1}))}},_=a=>{A({...d,[a.target.name]:a.target.value})},O=()=>{const a=g.filter((r,s)=>s!==p);j(a),alert("Item removed from the sales return list."),C(!1)},U=()=>{y(!0),E(null)},k=()=>{y(!1)},W=async()=>{const a=d.bill_number;if(a.length>0){h({...o,fetch:!0});try{const s=(await v.get(`/api/retailsale/orders/${a}/`)).data;A({bill_number:s.bill_number,fullname:s.fullname,phone_number:s.phone_number,address:s.address}),s.items&&j(s.items)}catch(r){console.error("Error fetching bill details",r),alert("Failed to fetch bill details.")}finally{h({...o,fetch:!1})}}else alert("Please enter a valid Bill Number.")},H=(a,r)=>{const s=[...g],l=s[r];if(P.includes(l.barcode)){alert("This item has already been returned and cannot be selected again.");return}s[r].selected=a.target.checked,j(s)},K=async a=>{a.preventDefault(),h({...o,add:!0});const r=g.filter(l=>l.selected);if(r.length===0){alert("Please select at least one item."),h({...o,add:!1});return}const s={bill_number:{full_name:d.fullname,phone_number:d.phone_number,address:d.address},items:r.map(l=>({barcode:l.barcode,category:l.category,sub_category:l.sub_category,size:l.size,item_name:l.item_name}))};try{const l=await v.post("api/salesreturn/salesreturn/",s);console.log("Sales return data sent successfully:",l.data);const u=r.map(t=>t.barcode);I(t=>[...t,...u]);const m=l.data.data.return_id;j(t=>[...t,{...s,return_id:m,items:r}]),alert("Sales return processed successfully.")}catch(l){console.error("Error processing sales return",l),alert("Failed to process sales return.")}finally{h({...o,add:!1}),y(!1)}};return e.jsxs(b,{sx:{maxWidth:"100%",padding:2,overflow:"hidden"},children:[e.jsx(x,{variant:"contained",color:"secondary",onClick:U,children:p!==null?"Edit Item":"Add Sales Return"}),e.jsxs(B,{open:w,onClose:k,children:[e.jsx(D,{style:{backgroundColor:"#f9dff5"},children:p!==null?"Edit Bill Details":"Add Bill Details"}),e.jsx(G,{style:{backgroundColor:"#f9dff5"},children:e.jsx(R,{sx:{padding:"20px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(b,{sx:{marginBottom:3},children:[e.jsx("h3",{children:"Customer Information"}),e.jsx(c,{fullWidth:!0,label:"Bill Number",name:"bill_number",value:d.bill_number,onChange:_,margin:"normal"}),e.jsx(x,{variant:"contained",color:"secondary",onClick:W,disabled:o.fetch,children:o.fetch?e.jsx(N,{size:24}):"CHECK HERE"}),e.jsxs(b,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[e.jsx(c,{label:"Full Name",name:"fullname",value:d.fullname,onChange:_,margin:"normal"}),e.jsx(c,{label:"Phone Number",name:"phone_number",value:d.phone_number,onChange:_,margin:"normal"})]}),e.jsx(c,{fullWidth:!0,label:"Address",name:"address",value:d.address,onChange:_,margin:"normal"})]}),e.jsxs(b,{sx:{marginBottom:3},children:[e.jsx("h3",{children:"Item Information"}),g.map((a,r)=>e.jsxs(b,{sx:{marginBottom:2},children:[e.jsxs(b,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:2},children:[e.jsx(c,{label:"Item Name",value:a.item_name,disabled:!0,margin:"normal"}),e.jsx(c,{label:"Category",value:a.category,disabled:!0,margin:"normal"}),e.jsx(c,{label:"Sub Category",value:a.sub_category,disabled:!0,margin:"normal"}),e.jsx(c,{label:"Size",value:a.size,disabled:!0,margin:"normal"})]}),e.jsx(c,{fullWidth:!0,label:"Barcode",value:a.barcode,disabled:!0,margin:"normal"}),e.jsx(b,{sx:{marginTop:1},children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:a.selected||!1,onChange:s=>H(s,r)}),"Select Item"]})})]},r))]})]})})}),e.jsxs(T,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(x,{onClick:k,color:"error",children:"Cancel"}),e.jsx(x,{onClick:K,color:"secondary",disabled:o.add,children:o.add?e.jsx(N,{size:24}):p!==null?"Update":"Add"})]})]}),e.jsx(J,{component:R,sx:{marginTop:3,overflow:"hidden"},children:e.jsxs(M,{children:[e.jsx(Q,{children:e.jsxs(f,{children:[e.jsx(n,{children:"Return ID"}),e.jsx(n,{children:"Full Name"}),e.jsx(n,{children:"Phone Number"}),e.jsx(n,{children:"Address"}),e.jsx(n,{children:"Item Name"}),e.jsx(n,{children:"Barcode"}),e.jsx(n,{children:"Category"}),e.jsx(n,{children:"Sub Category"}),e.jsx(n,{children:"Size"})]})}),e.jsx(V,{children:o.tableFetch?e.jsx(f,{children:e.jsx(n,{colSpan:5,align:"center",children:e.jsx(N,{})})}):S&&S.length>0?S.map((a,r)=>{var s,l,u,m;return e.jsxs(X.Fragment,{children:[e.jsxs(f,{children:[e.jsx(n,{rowSpan:((s=a.items)==null?void 0:s.length)+1,children:a.return_id||"N/A"}),e.jsx(n,{rowSpan:((l=a.items)==null?void 0:l.length)+1,children:a.full_name||"Unknown"}),e.jsx(n,{rowSpan:((u=a.items)==null?void 0:u.length)+1,children:a.phone_number||"N/A"}),e.jsx(n,{rowSpan:((m=a.items)==null?void 0:m.length)+1,children:a.address||"N/A"})]}),a.items&&a.items.length>0?a.items.map((t,$)=>e.jsxs(f,{children:[e.jsx(n,{children:t.item_name||"Unknown"}),e.jsx(n,{children:t.barcode||"N/A"}),e.jsx(n,{children:t.category||"N/A"}),e.jsx(n,{children:t.sub_category||"N/A"}),e.jsx(n,{children:t.size||"N/A"})]},$)):e.jsx(f,{children:e.jsx(n,{colSpan:5,align:"center",children:"No items available"})})]},r)}):e.jsx(f,{children:e.jsx(n,{colSpan:5,align:"center",children:"No returns available"})})})]})}),e.jsxs(B,{open:F,onClose:()=>C(!1),children:[e.jsx(D,{children:"Confirm Delete"}),e.jsxs(T,{children:[e.jsx(x,{onClick:()=>C(!1),color:"secondary",children:"Cancel"}),e.jsx(x,{onClick:O,color:"error",children:"Confirm"})]})]})]})}export{Z as default};
