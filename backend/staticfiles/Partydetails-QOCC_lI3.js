import{r as a,j as e,J as le,K as h,M as K,O as z,Q as B,S as I,T as l,a6 as oe,a7 as de,a8 as ce,a9 as C,U as c,V as Z,W as ue,X as me,Y as pe,Z as he,_ as G,$ as t,a0 as D,a1 as fe,a2 as xe,a3 as ye,G as y}from"./index-D56_o9iE.js";import{E as ge}from"./jspdf.plugin.autotable-DwG2OO1T.js";import{D as je}from"./Download-BcoFGlUQ.js";function Ce(){const[s,f]=a.useState({party_name:"",gst_number:"",registration_number:"",party_type:"",phone:"",email:"",address:"",description:""}),[u,P]=a.useState([]),[N,m]=a.useState({add:!1}),[L,x]=a.useState(!1),[g,T]=a.useState(null),[O,V]=a.useState(null),[F,j]=a.useState(!1),E=a.useRef(null),w=a.useRef(null),M=a.useRef(null),A=a.useRef(null),v=a.useRef(null),b=a.useRef(null),k=a.useRef(null),U=a.useRef(null),S=async()=>{m(r=>({...r,fetch:!0}));try{const r=await y.get("/api/user/party/");P(r.data.data)}catch(r){console.error("Error fetching items:",r)}finally{m(r=>({...r,fetch:!1}))}};a.useEffect(()=>{S()},[]);const o=r=>{f({...s,[r.target.name]:r.target.value})},Y=()=>{x(!0),T(null)},q=()=>{x(!1)},H=async r=>{r.preventDefault(),m(i=>({...i,add:!0}));const n=[],p=/^[A-Za-z-\s]+$/,re=/^[A-Za-z0-9]+$/,ne=/^[A-Za-z0-9]+$/,se=/^[0-9]{10}$/,te=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,$=/^[A-Za-z0-9-\s,]+$/;if(s.party_name.trim()?p.test(s.party_name)||n.push("Party Name can only contain letters, hyphens (-), and spaces."):n.push("Party Name is required."),s.gst_number.trim()?re.test(s.gst_number)||n.push("GST Number can only contain letters and numbers."):n.push("GST Number is required."),s.registration_number.trim()?ne.test(s.registration_number)||n.push("Registration Number can only contain letters and numbers."):n.push("Registration Number is required."),s.party_type.trim()||n.push("Party Type is required."),s.phone.trim()?se.test(s.phone)||n.push("Phone Number must be exactly 10 digits."):n.push("Phone Number is required."),s.email.trim()?te.test(s.email)||n.push("Enter a valid email address."):n.push("Email is required."),s.address.trim()&&!$.test(s.address)&&n.push("Address can only contain letters, numbers, spaces, hyphens (-), and commas (,). "),s.description.trim()&&!$.test(s.description)&&n.push("Description can only contain letters, numbers, spaces, hyphens (-), and commas (,). "),n.length>0){alert(`Validation Errors:
`+n.join(`
`)),m(i=>({...i,add:!1}));return}try{if(g!==null){const i=await y.put(`/api/user/party/${s.party_name}/`,s);alert(i.data.message)}else{const i=await y.post("/api/user/party/",s);alert(i.data.message)}S()}catch(i){if(console.error("Error adding/updating party:",i),i.response&&i.response.data){const R=i.response.data.error;let _="";if(typeof R=="string")_=R;else for(const[ae,ie]of Object.entries(R))_+=`${ae.toUpperCase()}: ${ie.join(", ")}
`;alert(`Backend Validation Errors:
${_}`)}else alert("An unknown error occurred.")}finally{m(i=>({...i,add:!1})),f({party_name:"",gst_number:"",registration_number:"",party_type:"",phone:"",email:"",address:"",description:""}),x(!1)}},J=r=>{f(u[r]),T(r),x(!0)},Q=r=>{V(r),j(!0),f(u[r])},X=async()=>{try{await y.delete(`/api/user/party/${s.party_name}/`,s);const r=u.filter((n,p)=>p!==O);P(r)}catch(r){console.error("Error deleting party:",r)}finally{j(!1)}},W=()=>{j(!1)},d=(r,n)=>{r.key==="Enter"&&n&&(r.preventDefault(),n.current.focus())},ee=()=>{const r=new ge;r.text("Party List Report",14,15),r.autoTable({startY:25,head:[["#","Party Name","Party Type","Phone","Email","GST Number","Registration No.","Address"]],body:u.map((n,p)=>[p+1,n.party_name,n.party_type,n.phone,n.email,n.gst_number,n.registration_number,n.address]),theme:"striped"}),r.save("Party_List.pdf")};return e.jsxs(le,{sx:{maxWidth:"100%",padding:2},children:[e.jsx(h,{variant:"contained",color:"secondary",onClick:Y,children:g!==null?"Edit Party":"Add Party"}),e.jsxs(K,{open:L,onClose:q,maxWidth:"md",fullWidth:!0,children:[e.jsx(z,{style:{backgroundColor:"#f9dff5"},children:g!==null?"Edit Party Details":"Add Party Details"}),e.jsx(B,{style:{backgroundColor:"#f9dff5"},children:e.jsx(I,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:e.jsxs("form",{children:[e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsxs(oe,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(de,{children:"Party Type"}),e.jsxs(ce,{value:s.party_type,name:"party_type",onChange:o,label:"Party Type",inputRef:M,onKeyDown:r=>d(r,E),children:[e.jsx(C,{value:"Vendor",children:"Vendor"}),e.jsx(C,{value:"Supplier",children:"Supplier"}),e.jsx(C,{value:"Customer",children:"Customer"})]})]})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Party Name",name:"party_name",value:s.party_name,onChange:o,margin:"normal",required:!0,inputRef:E,onKeyDown:r=>d(r,w)})})]}),e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"GST Number",name:"gst_number",value:s.gst_number,onChange:o,margin:"normal",required:!0,inputRef:w,onKeyDown:r=>d(r,A)})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Phone Number",name:"phone",value:s.phone,onChange:o,margin:"normal",required:!0,inputRef:A,onKeyDown:r=>d(r,v)})})]}),e.jsxs(l,{container:!0,spacing:2,marginBottom:2,children:[e.jsxs(l,{item:!0,xs:6,children:[e.jsx(c,{fullWidth:!0,label:"Email",name:"email",value:s.email,onChange:o,margin:"normal",required:!0,inputRef:v,onKeyDown:r=>d(r,b)}),e.jsx(c,{fullWidth:!0,label:"Registration Number",name:"registration_number",value:s.registration_number,onChange:o,margin:"normal",required:!0,inputRef:U,onKeyDown:r=>d(r,b)})]}),e.jsxs(l,{item:!0,xs:6,children:[e.jsx(c,{fullWidth:!0,multiline:!0,label:"Address",name:"address",value:s.address,onChange:o,margin:"normal",inputRef:b,onKeyDown:r=>d(r,k)}),e.jsx(c,{fullWidth:!0,multiline:!0,rows:2,label:"Description",name:"description",value:s.description,onChange:o,margin:"normal",inputRef:k})]})]})]})})}),e.jsxs(Z,{style:{backgroundColor:"#f9dff5"},children:[e.jsx(h,{onClick:q,color:"error",children:"Cancel"}),e.jsx(h,{onClick:H,color:"secondary",disabled:N.add,children:N.add?e.jsx(ue,{size:24}):"Submit"})]})]}),e.jsxs(K,{open:F,onClose:W,children:[e.jsx(z,{children:"Confirm Delete"}),e.jsx(B,{children:"Are you sure you want to delete this party?"}),e.jsxs(Z,{children:[e.jsx(h,{onClick:W,color:"error",children:"No"}),e.jsx(h,{onClick:X,color:"secondary",children:"Yes"})]})]}),e.jsx(me,{component:I,sx:{marginTop:2},children:e.jsxs(pe,{children:[e.jsx(he,{children:e.jsxs(G,{children:[e.jsx(t,{children:"Party Name"}),e.jsx(t,{children:"Party Type"}),e.jsx(t,{children:"Phone"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"GST Number"}),e.jsx(t,{children:"Registraion No."}),e.jsx(t,{children:"Address"}),e.jsx(t,{children:"Description"}),e.jsx(t,{children:"Actions"}),e.jsx(t,{children:e.jsx(D,{color:"primary",onClick:ee,children:e.jsx(je,{})})})]})}),e.jsx(fe,{children:u.map((r,n)=>e.jsxs(G,{children:[e.jsx(t,{children:r.party_name}),e.jsx(t,{children:r.party_type}),e.jsx(t,{children:r.phone}),e.jsx(t,{children:r.email}),e.jsx(t,{children:r.gst_number}),e.jsx(t,{children:r.registration_number}),e.jsx(t,{children:r.address}),e.jsx(t,{children:r.description}),e.jsxs(t,{children:[e.jsx(D,{onClick:()=>J(n),color:"secondary",children:e.jsx(xe,{})}),e.jsx(D,{onClick:()=>Q(n),color:"error",children:e.jsx(ye,{})})]})]},r.party_name))})]})})]})}export{Ce as default};
