import{a5 as ae,j as t,r,J as je,K as g,M as Q,O as Z,Q as M,S as F,U as d,a6 as V,a7 as G,a8 as J,a9 as X,a0 as D,V as ee,W as be,X as De,$ as o,Y as te,Z as se,_ as S,a1 as ne,a2 as Se,a3 as ke,G as y}from"./index-CazraW2q.js";import{E as Re}from"./jspdf.plugin.autotable-CgCzBP2g.js";import{D as ve}from"./Download-C15hmGkq.js";const we=ae(t.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle"),ze=ae(t.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11H7v-2h10z"}),"RemoveCircle");function qe(){const[n,c]=r.useState({item_name:"",item_code:"",category_item:"",sub_category:"",hsn_code:"",unit_price:"",stock_quantity:"",description:"",sizes:[]}),[u,I]=r.useState([]),[k,re]=r.useState([]),[R,oe]=r.useState([]),[h,v]=r.useState({add:!1}),[ie,w]=r.useState(!1),[_,A]=r.useState(null),[le,ce]=r.useState(null),[de,C]=r.useState(!1),ue=r.useRef([]),he=r.useRef(null),E=r.useRef(null),q=r.useRef(null),W=r.useRef(null),T=r.useRef(null),$=r.useRef(null),N=r.useRef(null),H=r.useRef(null),K=r.useRef(null),B=async()=>{try{const e=await y.get("/api/user/items/");I(e.data.data)}catch(e){console.error("Error fetching items:",e)}},me=async()=>{try{const e=await y.get("/api/user/categories/");re(e.data)}catch(e){console.error("Error fetching categories:",e)}};r.useEffect(()=>{B(),me()},[]);const fe=()=>{let e=[];n.item_name||e.push("⚠️ Item Name is required."),n.item_code||e.push("⚠️ Item Code is required."),n.hsn_code||e.push("⚠️ HSN Code is required."),n.category_name||e.push("⚠️ Category is required."),n.sub_category||e.push("⚠️ Sub-Category is required.");const s=/^[A-Za-z\s']+$/,a=/^[A-Za-z0-9_]+$/,i=/^[A-Za-z0-9_]+$/,f=/^[A-Za-z0-9]+$/,x=/^[0-9]+(\.[0-9]+)?$/,_e=/^[0-9]+$/,Ce=/^[A-Za-z0-9\s,]*$/;return n.item_name&&!s.test(n.item_name)&&e.push("⚠️ Item Name: Only letters, spaces, and apostrophe are allowed."),n.item_code&&!a.test(n.item_code)&&e.push("⚠️ Item Code: Only alphanumeric and underscore are allowed."),n.hsn_code&&!i.test(n.hsn_code)&&e.push("⚠️ HSN Code: Only alphanumeric and underscore are allowed."),n.sizes.forEach((p,z)=>{p.size&&!f.test(p.size)&&e.push(`⚠️ Size ${z+1}: Only letters and numbers allowed.`),p.unit_price&&!x.test(p.unit_price)&&e.push(`⚠️ Unit Price ${z+1}: Only numbers and dot allowed.`),p.stock_quantity&&!_e.test(p.stock_quantity)&&e.push(`⚠️ Stock Quantity ${z+1}: Only digits allowed.`)}),n.description&&!Ce.test(n.description)&&e.push("⚠️ Description: Only letters, digits, spaces, and commas allowed."),e.length>0?(alert(e.join(`
`)),!1):!0},O=async e=>{if(e.preventDefault(),v({...h,add:!0}),!fe()){v({...h,add:!1});return}try{let s;_!==null?s=await y.put(`/api/user/items/update/${n.item_code}/`,n):s=await y.post("/api/user/items-post/",n),alert("✅ Success: "+s.data.message),await B()}catch(s){if(console.error("❌ Backend Error:",s),s.response)if(s.response.data&&typeof s.response.data=="object"){let a=Object.values(s.response.data).flat();alert(`❌ Backend Errors:
`+a.join(`
`))}else alert("❌ Error: "+s.response.data.message||"Something went wrong.");else alert("❌ Network error. Please try again.")}finally{v({...h,add:!1}),j()}},P=async e=>{const s=e.target.value;c({...n,category_name:s,sub_category_name:""});try{const a=await y.get(`/api/user/subcategories/${s}/`);oe(a.data)}catch(a){console.error("Error fetching subcategories:",a)}},m=e=>{c({...n,[e.target.name]:e.target.value})},pe=()=>{w(!0),A(null),c({item_name:"",item_code:"",category_name:"",sub_category:"",hsn_code:"",unit_price:"",stock_quantity:"",description:"",sizes:[]})},j=()=>{w(!1)},L=()=>{c(e=>({...e,sizes:[...e.sizes,{size:"",unit_price:"",stock_quantity:""}]}))},Y=e=>{c(s=>({...s,sizes:s.sizes.filter((a,i)=>i!==e)}))},ge=e=>{A(e),c(u[e]),w(!0)},U=e=>{ce(e),C(!0),c(u[e])},ye=async()=>{try{await y.delete(`/api/user/items/delete/${n.item_code}/`),I(u.filter((e,s)=>s!==le)),alert("Item deleted successfully!")}catch(e){console.error("Error deleting item:",e)}finally{C(!1)}},l=(e,s)=>{e.key==="Enter"&&(e.preventDefault(),s&&s.current&&s.current.focus())},b=(e,s,a)=>{const{value:i}=e.target;c(f=>{const x=[...f.sizes];return x[s]={...x[s],[a]:i},{...f,sizes:x}})},xe=()=>{const e=new Re;e.text("Item List Report",14,15),u.forEach((s,a)=>{e.autoTable({startY:e.autoTable.previous.finalY?e.autoTable.previous.finalY+10:20,head:[["#","Item Name","Item Code","Category","Sub-Category","HSN Code","Description"]],body:[[a+1,s.item_name,s.item_code,s.category_name,s.sub_category,s.hsn_code,s.description]],theme:"striped"}),e.autoTable({startY:e.autoTable.previous.finalY+5,head:[["#","Size","Unit Price","Stock Quantity"]],body:s.sizes.map((i,f)=>[f+1,i.size,i.unit_price,i.stock_quantity]),theme:"grid",styles:{cellPadding:2,fontSize:10}})}),e.save("Item_List.pdf")};return t.jsxs(je,{sx:{maxWidth:"100%",padding:2},children:[t.jsx(g,{variant:"contained",color:"secondary",onClick:pe,children:"Add Item"}),t.jsxs(Q,{open:ie,onClose:j,handleClose:j,editIndex:_,itemDetails:n,categories:k,subCategories:R,handleCategoryChange:P,handleChange:m,handleDeleteDialogOpen:U,handleAddOrUpdate:O,loading:h,fieldRefs:ue,handleKeyDown:l,handleSizeChange:b,addSize:L,removeSize:Y,children:[t.jsx(Z,{style:{backgroundColor:"#f9dff5"},children:_!==null?"Edit Item Details":"Add Item Details"}),t.jsx(M,{style:{backgroundColor:"#f9dff5"},children:t.jsx(F,{sx:{padding:"10px",backgroundColor:"#f9dff5"},elevation:0,children:t.jsxs("form",{children:[t.jsx(d,{fullWidth:!0,label:"Brand Name",name:"item_name",value:n.item_name,onChange:m,inputRef:he,onKeyDown:e=>l(e,E),margin:"normal"}),t.jsx(d,{fullWidth:!0,label:"Brand Code",name:"item_code",value:n.item_code,onChange:m,inputRef:E,onKeyDown:e=>l(e,q),margin:"normal"}),t.jsxs(V,{fullWidth:!0,margin:"normal",required:!0,children:[t.jsx(G,{children:"Category"}),t.jsx(J,{value:n.category_item,name:"category_item",onChange:P,inputRef:q,onKeyDown:e=>l(e,W),children:Array.isArray(k)&&k.map(e=>t.jsx(X,{value:e.category_name,children:e.category_name},e.id))})]}),t.jsxs(V,{fullWidth:!0,margin:"normal",required:!0,children:[t.jsx(G,{children:"Sub-Category"}),t.jsx(J,{value:n.sub_category,name:"sub_category",onChange:m,label:"Sub-Category",disabled:!n.category_name,inputRef:W,onKeyDown:e=>l(e,T),children:Array.isArray(R)&&R.map(e=>t.jsx(X,{value:e.name,children:e.name},e.id))})]}),t.jsx(d,{fullWidth:!0,label:"HSN Code",name:"hsn_code",value:n.hsn_code,onChange:m,inputRef:T,onKeyDown:e=>l(e,H),margin:"normal"}),t.jsx(d,{fullWidth:!0,label:"Description",name:"description",value:n.description,onChange:m,inputRef:H,onKeyDown:e=>l(e,K),margin:"normal"}),n.sizes.map((e,s)=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[t.jsx(d,{fullWidth:!0,label:"Size",name:"size",value:e.size,onChange:a=>b(a,s,"size"),inputRef:K,onKeyDown:a=>l(a,$),margin:"normal"}),t.jsx(d,{fullWidth:!0,label:"Unit Price",name:"unit_price",type:"number",value:e.unit_price,onChange:a=>b(a,s,"unit_price"),inputRef:$,onKeyDown:a=>l(a,N),margin:"normal"}),t.jsx(d,{fullWidth:!0,label:"Stock Quantity",name:"stock_quantity",type:"number",value:e.stock_quantity,onChange:a=>b(a,s,"stock_quantity"),inputRef:N,onKeyDown:a=>l(a,null),margin:"normal"}),t.jsx(D,{color:"secondary",onClick:()=>Y(s),children:t.jsx(ze,{})})]},s)),t.jsx(g,{variant:"outlined",startIcon:t.jsx(we,{}),onClick:L,children:"Add Size"})]})})}),t.jsxs(ee,{style:{backgroundColor:"#f9dff5"},children:[t.jsx(g,{onClick:j,color:"error",children:"Cancel"}),t.jsx(g,{onClick:O,color:"secondary",disabled:h.add,children:h.add?t.jsx(be,{size:24}):_!==null?"Update":"Add"})]})]}),t.jsxs(De,{component:F,sx:{marginTop:3,boxShadow:3,borderRadius:2,maxHeight:400,overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#888 #f1f1f1"},children:[t.jsxs(o,{children:[t.jsx(D,{color:"primary",onClick:xe,children:t.jsx(ve,{})}),t.jsx("b",{children:"DOWNLOAD STOCK DETAILS"})]}),t.jsxs(te,{stickyHeader:!0,children:[t.jsx(se,{sx:{backgroundColor:"#e0f7fa"},children:t.jsx(S,{children:["Brand Name","Brand Code","Category","Sub-Category","HSN Code","Stock details (size,price & quantities)","Description","Actions"].map(e=>t.jsx(o,{sx:{fontWeight:"bold"},children:e},e))})}),t.jsx(ne,{children:Array.isArray(u)&&u.map((e,s)=>t.jsxs(S,{children:[t.jsx(o,{children:e.item_name}),t.jsx(o,{children:e.item_code}),t.jsx(o,{children:e.category_name}),t.jsx(o,{children:e.sub_category}),t.jsx(o,{children:e.hsn_code}),t.jsx(o,{children:t.jsx("div",{style:{maxHeight:"100px",overflowY:"auto",scrollbarWidth:"thin",scrollbarColor:"#888 #f1f1f1"},children:t.jsxs(te,{size:"small",stickyHeader:!0,children:[t.jsx(se,{children:t.jsxs(S,{style:{backgroundColor:"#DDA0DD",position:"sticky",top:0,zIndex:1},children:[t.jsx(o,{sx:{fontWeight:"bold"},children:"Size"}),t.jsx(o,{sx:{fontWeight:"bold"},children:"Unit Price"}),t.jsx(o,{sx:{fontWeight:"bold"},children:"Stock Quantity"})]})}),t.jsx(ne,{children:e.sizes.map((a,i)=>t.jsxs(S,{children:[t.jsx(o,{children:a.size}),t.jsx(o,{children:a.unit_price}),t.jsx(o,{children:a.stock_quantity})]},i))})]})})}),t.jsx(o,{children:e.description}),t.jsxs(o,{children:[t.jsx(D,{color:"secondary",onClick:()=>ge(s),children:t.jsx(Se,{})}),t.jsx(D,{color:"error",onClick:()=>U(s),children:t.jsx(ke,{})}),t.jsxs(Q,{open:de,onClose:()=>C(!1),children:[t.jsx(Z,{children:"Confirm Delete"}),t.jsxs(M,{children:["Are you sure you want to delete ",n==null?void 0:n.item_name,"?"]}),t.jsxs(ee,{children:[t.jsx(g,{onClick:()=>C(!1),color:"primary",children:"Cancel"}),t.jsx(g,{onClick:ye,color:"error",children:"Delete"})]})]})]})]},s))})]})]})]})}export{qe as default};
